   1              		.syntax unified
   2              		.cpu cortex-m4
   3              		.eabi_attribute 27, 3
   4              		.fpu fpv4-sp-d16
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 6
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.thumb
  15              		.file	"spi.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.comm	bufferTX,2000,4
  20              		.comm	bufferRX,2000,4
  21              		.global	bufferIndex
  22              		.section	.bss.bufferIndex,"aw",%nobits
  23              		.align	2
  26              	bufferIndex:
  27 0000 00000000 		.space	4
  28              		.global	datalength
  29              		.section	.data.datalength,"aw",%progbits
  30              		.align	2
  33              	datalength:
  34 0000 D0070000 		.word	2000
  35              		.section	.text.init_SPI1,"ax",%progbits
  36              		.align	2
  37              		.global	init_SPI1
  38              		.thumb
  39              		.thumb_func
  41              	init_SPI1:
  42              	.LFB110:
  43              		.file 1 "App/STM32F4-Discovery/spi.c"
   1:App/STM32F4-Discovery/spi.c **** #include <stm32f4xx.h>
   2:App/STM32F4-Discovery/spi.c **** #include <stm32f4xx_spi.h>
   3:App/STM32F4-Discovery/spi.c **** #include <stm32f4xx_dma.h>
   4:App/STM32F4-Discovery/spi.c **** #include <stm32f4xx_rcc.h>
   5:App/STM32F4-Discovery/spi.c **** #include <stm32f4xx_gpio.h>
   6:App/STM32F4-Discovery/spi.c **** #include "spi.h"
   7:App/STM32F4-Discovery/spi.c **** 
   8:App/STM32F4-Discovery/spi.c **** 	
   9:App/STM32F4-Discovery/spi.c **** #define RESET_LOW()	GPIOA->BSRRL |= GPIO_Pin_3;
  10:App/STM32F4-Discovery/spi.c **** #define RESET_HIGH()    GPIOA->BSRRH |= GPIO_Pin_3;
  11:App/STM32F4-Discovery/spi.c **** #define CSON()		GPIOA->BSRRH |= GPIO_Pin_4; // chip select  
  12:App/STM32F4-Discovery/spi.c **** #define CSOFF()		GPIOA->BSRRL |= GPIO_Pin_4; // chip select  
  13:App/STM32F4-Discovery/spi.c **** 
  14:App/STM32F4-Discovery/spi.c **** #define MAX_BUFFER_LENGTH 2000
  15:App/STM32F4-Discovery/spi.c **** /* ----------------------------------------------------------*/
  16:App/STM32F4-Discovery/spi.c **** /* --    this function initializes the SPI1 peripheral     --*/
  17:App/STM32F4-Discovery/spi.c **** uint8_t bufferTX[MAX_BUFFER_LENGTH];
  18:App/STM32F4-Discovery/spi.c **** uint8_t bufferRX[MAX_BUFFER_LENGTH];
  19:App/STM32F4-Discovery/spi.c **** int bufferIndex = 0; 
  20:App/STM32F4-Discovery/spi.c **** int datalength = MAX_BUFFER_LENGTH;
  21:App/STM32F4-Discovery/spi.c **** void init_SPI1(void){
  44              		.loc 1 21 0
  45              		.cfi_startproc
  46              		@ args = 0, pretend = 0, frame = 104
  47              		@ frame_needed = 1, uses_anonymous_args = 0
  48 0000 80B5     		push	{r7, lr}
  49              	.LCFI0:
  50              		.cfi_def_cfa_offset 8
  51              		.cfi_offset 7, -8
  52              		.cfi_offset 14, -4
  53 0002 9AB0     		sub	sp, sp, #104
  54              	.LCFI1:
  55              		.cfi_def_cfa_offset 112
  56 0004 00AF     		add	r7, sp, #0
  57              	.LCFI2:
  58              		.cfi_def_cfa_register 7
  22:App/STM32F4-Discovery/spi.c **** 	
  23:App/STM32F4-Discovery/spi.c **** 	GPIO_InitTypeDef GPIO_InitStruct;
  24:App/STM32F4-Discovery/spi.c **** 	SPI_InitTypeDef SPI_InitStruct;
  25:App/STM32F4-Discovery/spi.c **** 	DMA_InitTypeDef DMA_InitStruct;
  26:App/STM32F4-Discovery/spi.c **** 	NVIC_InitTypeDef NVIC_InitStruct;
  27:App/STM32F4-Discovery/spi.c **** 
  28:App/STM32F4-Discovery/spi.c **** 	
  29:App/STM32F4-Discovery/spi.c **** 	
  30:App/STM32F4-Discovery/spi.c **** 	// enable clock for used IO pins
  31:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);
  59              		.loc 1 31 0
  60 0006 0120     		movs	r0, #1
  61 0008 0121     		movs	r1, #1
  62 000a FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  32:App/STM32F4-Discovery/spi.c **** 	
  33:App/STM32F4-Discovery/spi.c **** 	/* configure pins used by SPI1
  34:App/STM32F4-Discovery/spi.c **** 	 * PA5 = SCK
  35:App/STM32F4-Discovery/spi.c **** 	 * PA6 = MISO
  36:App/STM32F4-Discovery/spi.c **** 	 * PA7 = MOSI
  37:App/STM32F4-Discovery/spi.c **** 	 */
  38:App/STM32F4-Discovery/spi.c **** 	// MOSI 
  39:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_MOSI_PIN ;
  63              		.loc 1 39 0
  64 000e 8023     		movs	r3, #128
  65 0010 3B66     		str	r3, [r7, #96]
  40:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF;
  66              		.loc 1 40 0
  67 0012 0223     		movs	r3, #2
  68 0014 87F86430 		strb	r3, [r7, #100]
  41:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
  69              		.loc 1 41 0
  70 0018 0023     		movs	r3, #0
  71 001a 87F86630 		strb	r3, [r7, #102]
  42:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
  72              		.loc 1 42 0
  73 001e 0323     		movs	r3, #3
  74 0020 87F86530 		strb	r3, [r7, #101]
  43:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_DOWN;
  75              		.loc 1 43 0
  76 0024 0223     		movs	r3, #2
  77 0026 87F86730 		strb	r3, [r7, #103]
  44:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(GPIOA, &GPIO_InitStruct);
  78              		.loc 1 44 0
  79 002a 07F16003 		add	r3, r7, #96
  80 002e 6948     		ldr	r0, .L2
  81 0030 1946     		mov	r1, r3
  82 0032 FFF7FEFF 		bl	GPIO_Init
  45:App/STM32F4-Discovery/spi.c **** 	// SCK
  46:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_SCK_PIN;
  83              		.loc 1 46 0
  84 0036 2023     		movs	r3, #32
  85 0038 3B66     		str	r3, [r7, #96]
  47:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF;
  86              		.loc 1 47 0
  87 003a 0223     		movs	r3, #2
  88 003c 87F86430 		strb	r3, [r7, #100]
  48:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
  89              		.loc 1 48 0
  90 0040 0023     		movs	r3, #0
  91 0042 87F86630 		strb	r3, [r7, #102]
  49:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
  92              		.loc 1 49 0
  93 0046 0323     		movs	r3, #3
  94 0048 87F86530 		strb	r3, [r7, #101]
  50:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_DOWN;
  95              		.loc 1 50 0
  96 004c 0223     		movs	r3, #2
  97 004e 87F86730 		strb	r3, [r7, #103]
  51:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(GPIOA, &GPIO_InitStruct);
  98              		.loc 1 51 0
  99 0052 07F16003 		add	r3, r7, #96
 100 0056 5F48     		ldr	r0, .L2
 101 0058 1946     		mov	r1, r3
 102 005a FFF7FEFF 		bl	GPIO_Init
  52:App/STM32F4-Discovery/spi.c **** 	// MISO 
  53:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_MISO_PIN;
 103              		.loc 1 53 0
 104 005e 4023     		movs	r3, #64
 105 0060 3B66     		str	r3, [r7, #96]
  54:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF;
 106              		.loc 1 54 0
 107 0062 0223     		movs	r3, #2
 108 0064 87F86430 		strb	r3, [r7, #100]
  55:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_OD;
 109              		.loc 1 55 0
 110 0068 0123     		movs	r3, #1
 111 006a 87F86630 		strb	r3, [r7, #102]
  56:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 112              		.loc 1 56 0
 113 006e 0323     		movs	r3, #3
 114 0070 87F86530 		strb	r3, [r7, #101]
  57:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_NOPULL;
 115              		.loc 1 57 0
 116 0074 0023     		movs	r3, #0
 117 0076 87F86730 		strb	r3, [r7, #103]
  58:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(GPIOA, &GPIO_InitStruct);
 118              		.loc 1 58 0
 119 007a 07F16003 		add	r3, r7, #96
 120 007e 5548     		ldr	r0, .L2
 121 0080 1946     		mov	r1, r3
 122 0082 FFF7FEFF 		bl	GPIO_Init
  59:App/STM32F4-Discovery/spi.c **** 	
  60:App/STM32F4-Discovery/spi.c **** 	// connect SPI1 pins to SPI alternate function
  61:App/STM32F4-Discovery/spi.c **** 	GPIO_PinAFConfig(GPIOA, GPIO_PinSource5, GPIO_AF_SPI1);
 123              		.loc 1 61 0
 124 0086 5348     		ldr	r0, .L2
 125 0088 0521     		movs	r1, #5
 126 008a 0522     		movs	r2, #5
 127 008c FFF7FEFF 		bl	GPIO_PinAFConfig
  62:App/STM32F4-Discovery/spi.c **** 	GPIO_PinAFConfig(GPIOA, GPIO_PinSource6, GPIO_AF_SPI1);
 128              		.loc 1 62 0
 129 0090 5048     		ldr	r0, .L2
 130 0092 0621     		movs	r1, #6
 131 0094 0522     		movs	r2, #5
 132 0096 FFF7FEFF 		bl	GPIO_PinAFConfig
  63:App/STM32F4-Discovery/spi.c **** 	GPIO_PinAFConfig(GPIOA, GPIO_PinSource7, GPIO_AF_SPI1);
 133              		.loc 1 63 0
 134 009a 4E48     		ldr	r0, .L2
 135 009c 0721     		movs	r1, #7
 136 009e 0522     		movs	r2, #5
 137 00a0 FFF7FEFF 		bl	GPIO_PinAFConfig
  64:App/STM32F4-Discovery/spi.c **** 
  65:App/STM32F4-Discovery/spi.c **** 	
  66:App/STM32F4-Discovery/spi.c **** 	/* Configure the chip select pin
  67:App/STM32F4-Discovery/spi.c **** 	   in this case we will use PA4 */
  68:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = GPIO_Pin_4;
 138              		.loc 1 68 0
 139 00a4 1023     		movs	r3, #16
 140 00a6 3B66     		str	r3, [r7, #96]
  69:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_OUT;
 141              		.loc 1 69 0
 142 00a8 0123     		movs	r3, #1
 143 00aa 87F86430 		strb	r3, [r7, #100]
  70:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 144              		.loc 1 70 0
 145 00ae 0023     		movs	r3, #0
 146 00b0 87F86630 		strb	r3, [r7, #102]
  71:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 147              		.loc 1 71 0
 148 00b4 0323     		movs	r3, #3
 149 00b6 87F86530 		strb	r3, [r7, #101]
  72:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_UP;
 150              		.loc 1 72 0
 151 00ba 0123     		movs	r3, #1
 152 00bc 87F86730 		strb	r3, [r7, #103]
  73:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(GPIOA, &GPIO_InitStruct);
 153              		.loc 1 73 0
 154 00c0 07F16003 		add	r3, r7, #96
 155 00c4 4348     		ldr	r0, .L2
 156 00c6 1946     		mov	r1, r3
 157 00c8 FFF7FEFF 		bl	GPIO_Init
  74:App/STM32F4-Discovery/spi.c **** 	
  75:App/STM32F4-Discovery/spi.c **** 	GPIOA->BSRRL |= GPIO_Pin_4; // set PA4 high
 158              		.loc 1 75 0
 159 00cc 414B     		ldr	r3, .L2
 160 00ce 414A     		ldr	r2, .L2
 161 00d0 128B     		ldrh	r2, [r2, #24]	@ movhi
 162 00d2 92B2     		uxth	r2, r2
 163 00d4 42F01002 		orr	r2, r2, #16
 164 00d8 92B2     		uxth	r2, r2
 165 00da 1A83     		strh	r2, [r3, #24]	@ movhi
  76:App/STM32F4-Discovery/spi.c **** 
  77:App/STM32F4-Discovery/spi.c **** 	/* Configure the hard reset pin
  78:App/STM32F4-Discovery/spi.c **** 	   in this case we will use PA3 */
  79:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = GPIO_Pin_3;
 166              		.loc 1 79 0
 167 00dc 0823     		movs	r3, #8
 168 00de 3B66     		str	r3, [r7, #96]
  80:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_OUT;
 169              		.loc 1 80 0
 170 00e0 0123     		movs	r3, #1
 171 00e2 87F86430 		strb	r3, [r7, #100]
  81:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 172              		.loc 1 81 0
 173 00e6 0023     		movs	r3, #0
 174 00e8 87F86630 		strb	r3, [r7, #102]
  82:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 175              		.loc 1 82 0
 176 00ec 0323     		movs	r3, #3
 177 00ee 87F86530 		strb	r3, [r7, #101]
  83:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_UP;
 178              		.loc 1 83 0
 179 00f2 0123     		movs	r3, #1
 180 00f4 87F86730 		strb	r3, [r7, #103]
  84:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(GPIOA, &GPIO_InitStruct);
 181              		.loc 1 84 0
 182 00f8 07F16003 		add	r3, r7, #96
 183 00fc 3548     		ldr	r0, .L2
 184 00fe 1946     		mov	r1, r3
 185 0100 FFF7FEFF 		bl	GPIO_Init
  85:App/STM32F4-Discovery/spi.c **** 	
  86:App/STM32F4-Discovery/spi.c **** 	GPIOA->BSRRL |= GPIO_Pin_3; // set PA3 high
 186              		.loc 1 86 0
 187 0104 334B     		ldr	r3, .L2
 188 0106 334A     		ldr	r2, .L2
 189 0108 128B     		ldrh	r2, [r2, #24]	@ movhi
 190 010a 92B2     		uxth	r2, r2
 191 010c 42F00802 		orr	r2, r2, #8
 192 0110 92B2     		uxth	r2, r2
 193 0112 1A83     		strh	r2, [r3, #24]	@ movhi
  87:App/STM32F4-Discovery/spi.c **** 	
  88:App/STM32F4-Discovery/spi.c **** 	
  89:App/STM32F4-Discovery/spi.c **** 	 // set PA3 high
  90:App/STM32F4-Discovery/spi.c **** 	
  91:App/STM32F4-Discovery/spi.c **** 
  92:App/STM32F4-Discovery/spi.c **** 	// enable peripheral clock
  93:App/STM32F4-Discovery/spi.c **** 	RCC_APB2PeriphClockCmd(RCC_APB2Periph_SPI1, ENABLE);
 194              		.loc 1 93 0
 195 0114 4FF48050 		mov	r0, #4096
 196 0118 0121     		movs	r1, #1
 197 011a FFF7FEFF 		bl	RCC_APB2PeriphClockCmd
  94:App/STM32F4-Discovery/spi.c **** 	
  95:App/STM32F4-Discovery/spi.c **** 	/* configure SPI1 in Mode 0 
  96:App/STM32F4-Discovery/spi.c **** 	 * CPOL = 0 --> clock is low when idle
  97:App/STM32F4-Discovery/spi.c **** 	 * CPHA = 0 --> data is sampled at the first edge
  98:App/STM32F4-Discovery/spi.c **** 	 */
  99:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_Direction = SPI_Direction_2Lines_FullDuplex; // set to full duplex mode, sepera
 198              		.loc 1 99 0
 199 011e 0023     		movs	r3, #0
 200 0120 A7F84C30 		strh	r3, [r7, #76]	@ movhi
 100:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_Mode = SPI_Mode_Master;     // transmit in master mode, NSS pin has to be alway
 201              		.loc 1 100 0
 202 0124 4FF48273 		mov	r3, #260
 203 0128 A7F84E30 		strh	r3, [r7, #78]	@ movhi
 101:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_DataSize = SPI_DataSize_8b; // one packet of data is 8 bits wide
 204              		.loc 1 101 0
 205 012c 0023     		movs	r3, #0
 206 012e A7F85030 		strh	r3, [r7, #80]	@ movhi
 102:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_CPOL = SPI_CPOL_Low;        // clock is low when idle
 207              		.loc 1 102 0
 208 0132 0023     		movs	r3, #0
 209 0134 A7F85230 		strh	r3, [r7, #82]	@ movhi
 103:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_CPHA = SPI_CPHA_1Edge;      // data sampled at second edge
 210              		.loc 1 103 0
 211 0138 0023     		movs	r3, #0
 212 013a A7F85430 		strh	r3, [r7, #84]	@ movhi
 104:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_NSS = SPI_NSS_Soft | SPI_NSSInternalSoft_Set; // set the NSS management to inte
 213              		.loc 1 104 0
 214 013e 4FF44073 		mov	r3, #768
 215 0142 A7F85630 		strh	r3, [r7, #86]	@ movhi
 105:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_BaudRatePrescaler = SPI_BaudRatePrescaler_4; // SPI frequency is APB2 frequency
 216              		.loc 1 105 0
 217 0146 0823     		movs	r3, #8
 218 0148 A7F85830 		strh	r3, [r7, #88]	@ movhi
 106:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_FirstBit = SPI_FirstBit_MSB;// data is transmitted MSB first
 219              		.loc 1 106 0
 220 014c 0023     		movs	r3, #0
 221 014e A7F85A30 		strh	r3, [r7, #90]	@ movhi
 107:App/STM32F4-Discovery/spi.c **** 	SPI_Init(SPI1, &SPI_InitStruct); 
 222              		.loc 1 107 0
 223 0152 07F14C03 		add	r3, r7, #76
 224 0156 2048     		ldr	r0, .L2+4
 225 0158 1946     		mov	r1, r3
 226 015a FFF7FEFF 		bl	SPI_Init
 108:App/STM32F4-Discovery/spi.c **** 	
 109:App/STM32F4-Discovery/spi.c **** 
 110:App/STM32F4-Discovery/spi.c **** 
 111:App/STM32F4-Discovery/spi.c **** 	
 112:App/STM32F4-Discovery/spi.c **** 
 113:App/STM32F4-Discovery/spi.c **** 	/* setup DMA */
 114:App/STM32F4-Discovery/spi.c **** 
 115:App/STM32F4-Discovery/spi.c **** 	// enable clock 
 116:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd (SPIx_DMA_CLK, ENABLE); 
 227              		.loc 1 116 0
 228 015e 4FF40010 		mov	r0, #2097152
 229 0162 0121     		movs	r1, #1
 230 0164 FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
 117:App/STM32F4-Discovery/spi.c **** 	
 118:App/STM32F4-Discovery/spi.c **** 	/*// start with blank DMA configuration
 119:App/STM32F4-Discovery/spi.c **** 	DMA_DeInit (SPIx_TX_DMA_STREAM);
 120:App/STM32F4-Discovery/spi.c **** 	DMA_DeInit (SPIx_RX_DMA_STREAM);
 121:App/STM32F4-Discovery/spi.c **** 
 122:App/STM32F4-Discovery/spi.c **** 	// check if DMA stream is disabled before enabling 
 123:App/STM32F4-Discovery/spi.c **** 	// this is useful when stream is enabled and disabled multiple times. 
 124:App/STM32F4-Discovery/spi.c **** 	while (DMA_GetCmdStatus (SPIx_TX_DMA_STREAM) != DISABLE);
 125:App/STM32F4-Discovery/spi.c **** 	while (DMA_GetCmdStatus (SPIx_RX_DMA_STREAM) != DISABLE);
 126:App/STM32F4-Discovery/spi.c **** 	
 127:App/STM32F4-Discovery/spi.c **** 	
 128:App/STM32F4-Discovery/spi.c **** 	DMA_StructInit(&DMA_InitStruct);
 129:App/STM32F4-Discovery/spi.c ****   Configure DMA Initialization Structure */
 130:App/STM32F4-Discovery/spi.c ****   	//DMA_InitStruct.DMA_BufferSize = 2000;
 131:App/STM32F4-Discovery/spi.c ****  /*	DMA_InitStruct.DMA_FIFOMode = DMA_FIFOMode_Enable ;
 132:App/STM32F4-Discovery/spi.c ****  	DMA_InitStruct.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull ;
 133:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_MemoryBurst = DMA_MemoryBurst_Single ;
 134:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_MemoryDataSize = DMA_MemoryDataSize_Byte;
 135:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_MemoryInc = DMA_MemoryInc_Enable;
 136:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Mode = DMA_Mode_Normal;
 137:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralBaseAddr =(uint32_t) (&(SPIx->DR)) ;
 138:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;
 139:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Byte;
 140:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralInc = DMA_PeripheralInc_Enable;
 141:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Priority = DMA_Priority_High;
 142:App/STM32F4-Discovery/spi.c ****   	 Configure TX DMA */
 143:App/STM32F4-Discovery/spi.c ****   /*	DMA_InitStruct.DMA_Channel = SPIx_TX_DMA_CHANNEL ;
 144:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_DIR = DMA_DIR_MemoryToPeripheral ;
 145:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Memory0BaseAddr = (uint32_t) &bufferTX ;
 146:App/STM32F4-Discovery/spi.c **** 	DMA_InitStruct.DMA_BufferSize = MAX_BUFFER_LENGTH;
 147:App/STM32F4-Discovery/spi.c ****   	DMA_Init(SPIx_TX_DMA_STREAM, &DMA_InitStruct);
 148:App/STM32F4-Discovery/spi.c ****   	 Configure RX DMA */
 149:App/STM32F4-Discovery/spi.c **** //  	DMA_InitStruct.DMA_Channel = SPIx_RX_DMA_CHANNEL ;
 150:App/STM32F4-Discovery/spi.c ****   //	DMA_InitStruct.DMA_DIR = DMA_DIR_PeripheralToMemory ;
 151:App/STM32F4-Discovery/spi.c ****   //	DMA_InitStruct.DMA_Memory0BaseAddr = (uint32_t)&bufferRX; 
 152:App/STM32F4-Discovery/spi.c **** //	DMA_InitStruct.DMA_BufferSize = MAX_BUFFER_LENGTH;
 153:App/STM32F4-Discovery/spi.c **** 	
 154:App/STM32F4-Discovery/spi.c **** //	DMA_ITConfig(SPIx_TX_DMA_STREAM, DMA_IT_TC, ENABLE); 
 155:App/STM32F4-Discovery/spi.c ****   
 156:App/STM32F4-Discovery/spi.c **** //	DMA_Init(SPIx_RX_DMA_STREAM, &DMA_InitStruct);
 157:App/STM32F4-Discovery/spi.c ****   //	SPI_I2S_DMACmd (SPIx, SPI_I2S_DMAReq_Tx, ENABLE);
 158:App/STM32F4-Discovery/spi.c ****   //	SPI_I2S_DMACmd (SPIx, SPI_I2S_DMAReq_Rx, ENABLE);
 159:App/STM32F4-Discovery/spi.c **** 
 160:App/STM32F4-Discovery/spi.c **** //	SPI_I2S_ClearFlag(SPIx, SPI_I2S_FLAG_TXE);
 161:App/STM32F4-Discovery/spi.c **** //	SPI_I2S_ClearFlag(SPIx, SPI_I2S_FLAG_RXNE);
 162:App/STM32F4-Discovery/spi.c ****   	
 163:App/STM32F4-Discovery/spi.c **** 	// enable the interrupt in the NVIC
 164:App/STM32F4-Discovery/spi.c ****  //	NVIC_InitStruct.NVIC_IRQChannel = DMA1_Stream3_IRQn;
 165:App/STM32F4-Discovery/spi.c ****   //	NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = 0;
 166:App/STM32F4-Discovery/spi.c ****   //	NVIC_InitStruct.NVIC_IRQChannelSubPriority = 1;
 167:App/STM32F4-Discovery/spi.c ****   //	NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;
 168:App/STM32F4-Discovery/spi.c ****   //	NVIC_Init (&NVIC_InitStruct);
 169:App/STM32F4-Discovery/spi.c ****   	// Enable dma tx and rx request
 170:App/STM32F4-Discovery/spi.c **** 	
 171:App/STM32F4-Discovery/spi.c **** 
 172:App/STM32F4-Discovery/spi.c **** 	
 173:App/STM32F4-Discovery/spi.c **** 
 174:App/STM32F4-Discovery/spi.c **** /*	   in this case we will use PA0 */
 175:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = GPIO_Pin_0;
 231              		.loc 1 175 0
 232 0168 0123     		movs	r3, #1
 233 016a 3B66     		str	r3, [r7, #96]
 176:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_IN;
 234              		.loc 1 176 0
 235 016c 0023     		movs	r3, #0
 236 016e 87F86430 		strb	r3, [r7, #100]
 177:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 237              		.loc 1 177 0
 238 0172 0023     		movs	r3, #0
 239 0174 87F86630 		strb	r3, [r7, #102]
 178:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 240              		.loc 1 178 0
 241 0178 0323     		movs	r3, #3
 242 017a 87F86530 		strb	r3, [r7, #101]
 179:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(GPIOA, &GPIO_InitStruct);	
 243              		.loc 1 179 0
 244 017e 07F16003 		add	r3, r7, #96
 245 0182 1448     		ldr	r0, .L2
 246 0184 1946     		mov	r1, r3
 247 0186 FFF7FEFF 		bl	GPIO_Init
 180:App/STM32F4-Discovery/spi.c **** 	
 181:App/STM32F4-Discovery/spi.c **** 	EXTI_InitTypeDef EXTI_InitStruct;
 182:App/STM32F4-Discovery/spi.c **** 	/* Connect EXTI Line to appropriate GPIO Pin */ 
 183:App/STM32F4-Discovery/spi.c **** 	SYSCFG_EXTILineConfig(EXTI_PortSourceGPIOA, EXTI_PinSource0);
 248              		.loc 1 183 0
 249 018a 0020     		movs	r0, #0
 250 018c 0021     		movs	r1, #0
 251 018e FFF7FEFF 		bl	SYSCFG_EXTILineConfig
 184:App/STM32F4-Discovery/spi.c **** 	
 185:App/STM32F4-Discovery/spi.c **** 	/* Configure EXTI Line */
 186:App/STM32F4-Discovery/spi.c **** 	EXTI_InitStruct.EXTI_Line = EXTI_Line0;
 252              		.loc 1 186 0
 253 0192 0123     		movs	r3, #1
 254 0194 7B60     		str	r3, [r7, #4]
 187:App/STM32F4-Discovery/spi.c ****  	EXTI_InitStruct.EXTI_Mode = EXTI_Mode_Interrupt;
 255              		.loc 1 187 0
 256 0196 0023     		movs	r3, #0
 257 0198 3B72     		strb	r3, [r7, #8]
 188:App/STM32F4-Discovery/spi.c **** 	EXTI_InitStruct.EXTI_Trigger = EXTI_Trigger_Falling;
 258              		.loc 1 188 0
 259 019a 0C23     		movs	r3, #12
 260 019c 7B72     		strb	r3, [r7, #9]
 189:App/STM32F4-Discovery/spi.c **** 	EXTI_InitStruct.EXTI_LineCmd = ENABLE;
 261              		.loc 1 189 0
 262 019e 0123     		movs	r3, #1
 263 01a0 BB72     		strb	r3, [r7, #10]
 190:App/STM32F4-Discovery/spi.c **** 	EXTI_Init(&EXTI_InitStruct);
 264              		.loc 1 190 0
 265 01a2 3B1D     		adds	r3, r7, #4
 266 01a4 1846     		mov	r0, r3
 267 01a6 FFF7FEFF 		bl	EXTI_Init
 191:App/STM32F4-Discovery/spi.c ****  	
 192:App/STM32F4-Discovery/spi.c ****  	/* Enable and set EXTI Line Interrupt */
 193:App/STM32F4-Discovery/spi.c **** 	NVIC_InitStruct.NVIC_IRQChannel = EXTI0_IRQn;
 268              		.loc 1 193 0
 269 01aa 0623     		movs	r3, #6
 270 01ac 3B73     		strb	r3, [r7, #12]
 194:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = 0x01;
 271              		.loc 1 194 0
 272 01ae 0123     		movs	r3, #1
 273 01b0 7B73     		strb	r3, [r7, #13]
 195:App/STM32F4-Discovery/spi.c **** 	NVIC_InitStruct.NVIC_IRQChannelSubPriority = 0x01;
 274              		.loc 1 195 0
 275 01b2 0123     		movs	r3, #1
 276 01b4 BB73     		strb	r3, [r7, #14]
 196:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;
 277              		.loc 1 196 0
 278 01b6 0123     		movs	r3, #1
 279 01b8 FB73     		strb	r3, [r7, #15]
 197:App/STM32F4-Discovery/spi.c **** 	NVIC_Init(&NVIC_InitStruct);
 280              		.loc 1 197 0
 281 01ba 07F10C03 		add	r3, r7, #12
 282 01be 1846     		mov	r0, r3
 283 01c0 FFF7FEFF 		bl	NVIC_Init
 198:App/STM32F4-Discovery/spi.c **** 
 199:App/STM32F4-Discovery/spi.c **** 	SPI_Cmd(SPI1, ENABLE);		
 284              		.loc 1 199 0
 285 01c4 0448     		ldr	r0, .L2+4
 286 01c6 0121     		movs	r1, #1
 287 01c8 FFF7FEFF 		bl	SPI_Cmd
 200:App/STM32F4-Discovery/spi.c **** 	
 201:App/STM32F4-Discovery/spi.c **** }
 288              		.loc 1 201 0
 289 01cc 6837     		adds	r7, r7, #104
 290 01ce BD46     		mov	sp, r7
 291              		@ sp needed
 292 01d0 80BD     		pop	{r7, pc}
 293              	.L3:
 294 01d2 00BF     		.align	2
 295              	.L2:
 296 01d4 00000240 		.word	1073872896
 297 01d8 00300140 		.word	1073819648
 298              		.cfi_endproc
 299              	.LFE110:
 301              		.section	.text.SPI_IRQHandler,"ax",%progbits
 302              		.align	2
 303              		.global	SPI_IRQHandler
 304              		.thumb
 305              		.thumb_func
 307              	SPI_IRQHandler:
 308              	.LFB111:
 202:App/STM32F4-Discovery/spi.c **** 
 203:App/STM32F4-Discovery/spi.c **** 
 204:App/STM32F4-Discovery/spi.c **** 
 205:App/STM32F4-Discovery/spi.c **** 
 206:App/STM32F4-Discovery/spi.c **** void SPI_IRQHandler()
 207:App/STM32F4-Discovery/spi.c **** {
 309              		.loc 1 207 0
 310              		.cfi_startproc
 311              		@ args = 0, pretend = 0, frame = 0
 312              		@ frame_needed = 1, uses_anonymous_args = 0
 313 0000 80B5     		push	{r7, lr}
 314              	.LCFI3:
 315              		.cfi_def_cfa_offset 8
 316              		.cfi_offset 7, -8
 317              		.cfi_offset 14, -4
 318 0002 00AF     		add	r7, sp, #0
 319              	.LCFI4:
 320              		.cfi_def_cfa_register 7
 208:App/STM32F4-Discovery/spi.c **** 	if (SPIx->SR & SPI_I2S_FLAG_TXE)
 321              		.loc 1 208 0
 322 0004 174B     		ldr	r3, .L7
 323 0006 1B89     		ldrh	r3, [r3, #8]	@ movhi
 324 0008 9BB2     		uxth	r3, r3
 325 000a 03F00203 		and	r3, r3, #2
 326 000e 002B     		cmp	r3, #0
 327 0010 0ED0     		beq	.L5
 209:App/STM32F4-Discovery/spi.c **** 	{
 210:App/STM32F4-Discovery/spi.c **** 		if (bufferIndex < datalength)
 328              		.loc 1 210 0
 329 0012 154B     		ldr	r3, .L7+4
 330 0014 1A68     		ldr	r2, [r3]
 331 0016 154B     		ldr	r3, .L7+8
 332 0018 1B68     		ldr	r3, [r3]
 333 001a 9A42     		cmp	r2, r3
 334 001c 08DA     		bge	.L5
 211:App/STM32F4-Discovery/spi.c **** 		{
 212:App/STM32F4-Discovery/spi.c **** 			SPIx->DR = bufferTX[bufferIndex++];
 335              		.loc 1 212 0
 336 001e 114A     		ldr	r2, .L7
 337 0020 114B     		ldr	r3, .L7+4
 338 0022 1B68     		ldr	r3, [r3]
 339 0024 581C     		adds	r0, r3, #1
 340 0026 1049     		ldr	r1, .L7+4
 341 0028 0860     		str	r0, [r1]
 342 002a 1149     		ldr	r1, .L7+12
 343 002c CB5C     		ldrb	r3, [r1, r3]	@ zero_extendqisi2
 344 002e 9381     		strh	r3, [r2, #12]	@ movhi
 345              	.L5:
 213:App/STM32F4-Discovery/spi.c **** 		}
 214:App/STM32F4-Discovery/spi.c **** 	}
 215:App/STM32F4-Discovery/spi.c **** 
 216:App/STM32F4-Discovery/spi.c **** 
 217:App/STM32F4-Discovery/spi.c **** 
 218:App/STM32F4-Discovery/spi.c **** 	if (!(SPIx->SR & SPI_I2S_FLAG_BSY))
 346              		.loc 1 218 0
 347 0030 0C4B     		ldr	r3, .L7
 348 0032 1B89     		ldrh	r3, [r3, #8]	@ movhi
 349 0034 9BB2     		uxth	r3, r3
 350 0036 03F08003 		and	r3, r3, #128
 351 003a 002B     		cmp	r3, #0
 352 003c 0CD1     		bne	.L6
 219:App/STM32F4-Discovery/spi.c **** 	{
 220:App/STM32F4-Discovery/spi.c **** 		SPI_I2S_ITConfig(SPIx,  SPI_I2S_IT_TXE, DISABLE);
 353              		.loc 1 220 0
 354 003e 0948     		ldr	r0, .L7
 355 0040 7121     		movs	r1, #113
 356 0042 0022     		movs	r2, #0
 357 0044 FFF7FEFF 		bl	SPI_I2S_ITConfig
 221:App/STM32F4-Discovery/spi.c **** 		CSOFF();
 358              		.loc 1 221 0
 359 0048 0A4B     		ldr	r3, .L7+16
 360 004a 0A4A     		ldr	r2, .L7+16
 361 004c 128B     		ldrh	r2, [r2, #24]	@ movhi
 362 004e 92B2     		uxth	r2, r2
 363 0050 42F01002 		orr	r2, r2, #16
 364 0054 92B2     		uxth	r2, r2
 365 0056 1A83     		strh	r2, [r3, #24]	@ movhi
 366              	.L6:
 222:App/STM32F4-Discovery/spi.c **** 	}
 223:App/STM32F4-Discovery/spi.c **** 
 224:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_ClearITPendingBit(SPIx, SPI_I2S_IT_TXE);
 367              		.loc 1 224 0
 368 0058 0248     		ldr	r0, .L7
 369 005a 7121     		movs	r1, #113
 370 005c FFF7FEFF 		bl	SPI_I2S_ClearITPendingBit
 225:App/STM32F4-Discovery/spi.c **** }
 371              		.loc 1 225 0
 372 0060 80BD     		pop	{r7, pc}
 373              	.L8:
 374 0062 00BF     		.align	2
 375              	.L7:
 376 0064 00300140 		.word	1073819648
 377 0068 00000000 		.word	bufferIndex
 378 006c 00000000 		.word	datalength
 379 0070 00000000 		.word	bufferTX
 380 0074 00000240 		.word	1073872896
 381              		.cfi_endproc
 382              	.LFE111:
 384              		.section	.text.SPI1_DMA_TX_IRQHandler,"ax",%progbits
 385              		.align	2
 386              		.global	SPI1_DMA_TX_IRQHandler
 387              		.thumb
 388              		.thumb_func
 390              	SPI1_DMA_TX_IRQHandler:
 391              	.LFB112:
 226:App/STM32F4-Discovery/spi.c **** 
 227:App/STM32F4-Discovery/spi.c **** int SPI1_DMA_TX_IRQHandler()
 228:App/STM32F4-Discovery/spi.c **** {
 392              		.loc 1 228 0
 393              		.cfi_startproc
 394              		@ args = 0, pretend = 0, frame = 0
 395              		@ frame_needed = 1, uses_anonymous_args = 0
 396 0000 80B5     		push	{r7, lr}
 397              	.LCFI5:
 398              		.cfi_def_cfa_offset 8
 399              		.cfi_offset 7, -8
 400              		.cfi_offset 14, -4
 401 0002 00AF     		add	r7, sp, #0
 402              	.LCFI6:
 403              		.cfi_def_cfa_register 7
 229:App/STM32F4-Discovery/spi.c ****   // Test if DMA Stream Transfer Complete interrupt
 230:App/STM32F4-Discovery/spi.c ****   if (DMA_GetITStatus (SPIx_TX_DMA_STREAM, DMA_IT_TCIF4)) {
 404              		.loc 1 230 0
 405 0004 0F48     		ldr	r0, .L13
 406 0006 1049     		ldr	r1, .L13+4
 407 0008 FFF7FEFF 		bl	DMA_GetITStatus
 408 000c 0346     		mov	r3, r0
 409 000e 002B     		cmp	r3, #0
 410 0010 15D0     		beq	.L10
 231:App/STM32F4-Discovery/spi.c ****     DMA_ClearITPendingBit (SPIx_TX_DMA_STREAM, DMA_IT_TCIF4);
 411              		.loc 1 231 0
 412 0012 0C48     		ldr	r0, .L13
 413 0014 0C49     		ldr	r1, .L13+4
 414 0016 FFF7FEFF 		bl	DMA_ClearITPendingBit
 232:App/STM32F4-Discovery/spi.c ****     while (SPI_I2S_GetFlagStatus (SPIx, SPI_I2S_FLAG_BSY) == SET);
 415              		.loc 1 232 0
 416 001a 00BF     		nop
 417              	.L11:
 418              		.loc 1 232 0 is_stmt 0 discriminator 1
 419 001c 0B48     		ldr	r0, .L13+8
 420 001e 8021     		movs	r1, #128
 421 0020 FFF7FEFF 		bl	SPI_I2S_GetFlagStatus
 422 0024 0346     		mov	r3, r0
 423 0026 012B     		cmp	r3, #1
 424 0028 F8D0     		beq	.L11
 233:App/STM32F4-Discovery/spi.c ****     /*
 234:App/STM32F4-Discovery/spi.c ****      * The DMA stream is disabled in hardware at the end of the transfer
 235:App/STM32F4-Discovery/spi.c ****      * Now we can deselect the display. If more than one peripheral was being run
 236:App/STM32F4-Discovery/spi.c ****      * on this SPI peripheral, we would have to do both/all of them, or work out
 237:App/STM32F4-Discovery/spi.c ****      * which one was active and deselect that one.i
 238:App/STM32F4-Discovery/spi.c **** 	
 239:App/STM32F4-Discovery/spi.c ****      */
 240:App/STM32F4-Discovery/spi.c **** 
 241:App/STM32F4-Discovery/spi.c **** 	CSOFF();
 425              		.loc 1 241 0 is_stmt 1
 426 002a 094B     		ldr	r3, .L13+12
 427 002c 084A     		ldr	r2, .L13+12
 428 002e 128B     		ldrh	r2, [r2, #24]	@ movhi
 429 0030 92B2     		uxth	r2, r2
 430 0032 42F01002 		orr	r2, r2, #16
 431 0036 92B2     		uxth	r2, r2
 432 0038 1A83     		strh	r2, [r3, #24]	@ movhi
 242:App/STM32F4-Discovery/spi.c **** 	return 0;
 433              		.loc 1 242 0
 434 003a 0023     		movs	r3, #0
 435 003c 00E0     		b	.L12
 436              	.L10:
 243:App/STM32F4-Discovery/spi.c ****   }
 244:App/STM32F4-Discovery/spi.c **** 	return 1;
 437              		.loc 1 244 0
 438 003e 0123     		movs	r3, #1
 439              	.L12:
 245:App/STM32F4-Discovery/spi.c **** }
 440              		.loc 1 245 0
 441 0040 1846     		mov	r0, r3
 442 0042 80BD     		pop	{r7, pc}
 443              	.L14:
 444              		.align	2
 445              	.L13:
 446 0044 58600240 		.word	1073897560
 447 0048 20800020 		.word	536903712
 448 004c 00300140 		.word	1073819648
 449 0050 00000240 		.word	1073872896
 450              		.cfi_endproc
 451              	.LFE112:
 453              		.section	.text.SPI1_send,"ax",%progbits
 454              		.align	2
 455              		.global	SPI1_send
 456              		.thumb
 457              		.thumb_func
 459              	SPI1_send:
 460              	.LFB113:
 246:App/STM32F4-Discovery/spi.c **** 
 247:App/STM32F4-Discovery/spi.c **** 
 248:App/STM32F4-Discovery/spi.c **** /* This funtion is used to transmit and receive data 
 249:App/STM32F4-Discovery/spi.c ****  * with SPI1
 250:App/STM32F4-Discovery/spi.c ****  * 			data --> data to be transmitted
 251:App/STM32F4-Discovery/spi.c ****  * 			returns received value
 252:App/STM32F4-Discovery/spi.c **** 
 253:App/STM32F4-Discovery/spi.c **** */
 254:App/STM32F4-Discovery/spi.c **** uint8_t SPI1_send(uint8_t data){
 461              		.loc 1 254 0
 462              		.cfi_startproc
 463              		@ args = 0, pretend = 0, frame = 16
 464              		@ frame_needed = 1, uses_anonymous_args = 0
 465 0000 80B5     		push	{r7, lr}
 466              	.LCFI7:
 467              		.cfi_def_cfa_offset 8
 468              		.cfi_offset 7, -8
 469              		.cfi_offset 14, -4
 470 0002 84B0     		sub	sp, sp, #16
 471              	.LCFI8:
 472              		.cfi_def_cfa_offset 24
 473 0004 00AF     		add	r7, sp, #0
 474              	.LCFI9:
 475              		.cfi_def_cfa_register 7
 476 0006 0346     		mov	r3, r0
 477 0008 FB71     		strb	r3, [r7, #7]
 255:App/STM32F4-Discovery/spi.c **** 
 256:App/STM32F4-Discovery/spi.c **** 	
 257:App/STM32F4-Discovery/spi.c **** 	while(!SPI_I2S_GetFlagStatus(SPI1, SPI_I2S_FLAG_TXE)); 
 478              		.loc 1 257 0
 479 000a 00BF     		nop
 480              	.L16:
 481              		.loc 1 257 0 is_stmt 0 discriminator 1
 482 000c 0F48     		ldr	r0, .L19
 483 000e 0221     		movs	r1, #2
 484 0010 FFF7FEFF 		bl	SPI_I2S_GetFlagStatus
 485 0014 0346     		mov	r3, r0
 486 0016 002B     		cmp	r3, #0
 487 0018 F8D0     		beq	.L16
 258:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_SendData(SPI1, data);
 488              		.loc 1 258 0 is_stmt 1
 489 001a FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 490 001c 9BB2     		uxth	r3, r3
 491 001e 0B48     		ldr	r0, .L19
 492 0020 1946     		mov	r1, r3
 493 0022 FFF7FEFF 		bl	SPI_I2S_SendData
 259:App/STM32F4-Discovery/spi.c **** 	
 260:App/STM32F4-Discovery/spi.c **** 	while(!SPI_I2S_GetFlagStatus(SPI1, SPI_I2S_FLAG_RXNE));
 494              		.loc 1 260 0
 495 0026 00BF     		nop
 496              	.L17:
 497              		.loc 1 260 0 is_stmt 0 discriminator 1
 498 0028 0848     		ldr	r0, .L19
 499 002a 0121     		movs	r1, #1
 500 002c FFF7FEFF 		bl	SPI_I2S_GetFlagStatus
 501 0030 0346     		mov	r3, r0
 502 0032 002B     		cmp	r3, #0
 503 0034 F8D0     		beq	.L17
 261:App/STM32F4-Discovery/spi.c **** 	uint8_t d = SPI_I2S_ReceiveData(SPI1);
 504              		.loc 1 261 0 is_stmt 1
 505 0036 0548     		ldr	r0, .L19
 506 0038 FFF7FEFF 		bl	SPI_I2S_ReceiveData
 507 003c 0346     		mov	r3, r0
 508 003e FB73     		strb	r3, [r7, #15]
 262:App/STM32F4-Discovery/spi.c **** 	return d;
 509              		.loc 1 262 0
 510 0040 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 263:App/STM32F4-Discovery/spi.c ****  	
 264:App/STM32F4-Discovery/spi.c **** }
 511              		.loc 1 264 0
 512 0042 1846     		mov	r0, r3
 513 0044 1037     		adds	r7, r7, #16
 514 0046 BD46     		mov	sp, r7
 515              		@ sp needed
 516 0048 80BD     		pop	{r7, pc}
 517              	.L20:
 518 004a 00BF     		.align	2
 519              	.L19:
 520 004c 00300140 		.word	1073819648
 521              		.cfi_endproc
 522              	.LFE113:
 524              		.section	.text.SPI1_recive,"ax",%progbits
 525              		.align	2
 526              		.global	SPI1_recive
 527              		.thumb
 528              		.thumb_func
 530              	SPI1_recive:
 531              	.LFB114:
 265:App/STM32F4-Discovery/spi.c **** 
 266:App/STM32F4-Discovery/spi.c **** uint8_t SPI1_recive(void)
 267:App/STM32F4-Discovery/spi.c **** {
 532              		.loc 1 267 0
 533              		.cfi_startproc
 534              		@ args = 0, pretend = 0, frame = 0
 535              		@ frame_needed = 1, uses_anonymous_args = 0
 536 0000 80B5     		push	{r7, lr}
 537              	.LCFI10:
 538              		.cfi_def_cfa_offset 8
 539              		.cfi_offset 7, -8
 540              		.cfi_offset 14, -4
 541 0002 00AF     		add	r7, sp, #0
 542              	.LCFI11:
 543              		.cfi_def_cfa_register 7
 268:App/STM32F4-Discovery/spi.c **** 
 269:App/STM32F4-Discovery/spi.c **** 	while(!SPI_I2S_GetFlagStatus(SPI1, SPI_I2S_FLAG_TXE)); 
 544              		.loc 1 269 0
 545 0004 00BF     		nop
 546              	.L22:
 547              		.loc 1 269 0 is_stmt 0 discriminator 1
 548 0006 0D48     		ldr	r0, .L25
 549 0008 0221     		movs	r1, #2
 550 000a FFF7FEFF 		bl	SPI_I2S_GetFlagStatus
 551 000e 0346     		mov	r3, r0
 552 0010 002B     		cmp	r3, #0
 553 0012 F8D0     		beq	.L22
 270:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_SendData(SPI1,0x0 );
 554              		.loc 1 270 0 is_stmt 1
 555 0014 0948     		ldr	r0, .L25
 556 0016 0021     		movs	r1, #0
 557 0018 FFF7FEFF 		bl	SPI_I2S_SendData
 271:App/STM32F4-Discovery/spi.c **** 	
 272:App/STM32F4-Discovery/spi.c **** 	while(!SPI_I2S_GetFlagStatus(SPI1, SPI_I2S_FLAG_RXNE));
 558              		.loc 1 272 0
 559 001c 00BF     		nop
 560              	.L23:
 561              		.loc 1 272 0 is_stmt 0 discriminator 1
 562 001e 0748     		ldr	r0, .L25
 563 0020 0121     		movs	r1, #1
 564 0022 FFF7FEFF 		bl	SPI_I2S_GetFlagStatus
 565 0026 0346     		mov	r3, r0
 566 0028 002B     		cmp	r3, #0
 567 002a F8D0     		beq	.L23
 273:App/STM32F4-Discovery/spi.c **** 	return SPI_I2S_ReceiveData(SPI1);
 568              		.loc 1 273 0 is_stmt 1
 569 002c 0348     		ldr	r0, .L25
 570 002e FFF7FEFF 		bl	SPI_I2S_ReceiveData
 571 0032 0346     		mov	r3, r0
 572 0034 DBB2     		uxtb	r3, r3
 274:App/STM32F4-Discovery/spi.c **** 	
 275:App/STM32F4-Discovery/spi.c **** }
 573              		.loc 1 275 0
 574 0036 1846     		mov	r0, r3
 575 0038 80BD     		pop	{r7, pc}
 576              	.L26:
 577 003a 00BF     		.align	2
 578              	.L25:
 579 003c 00300140 		.word	1073819648
 580              		.cfi_endproc
 581              	.LFE114:
 583              		.section	.text.spi_dma_send,"ax",%progbits
 584              		.align	2
 585              		.global	spi_dma_send
 586              		.thumb
 587              		.thumb_func
 589              	spi_dma_send:
 590              	.LFB115:
 276:App/STM32F4-Discovery/spi.c **** 
 277:App/STM32F4-Discovery/spi.c **** 
 278:App/STM32F4-Discovery/spi.c **** /*---------------------------- Matic Knap 25 Jun 2014 ---------------------*/
 279:App/STM32F4-Discovery/spi.c **** 
 280:App/STM32F4-Discovery/spi.c **** void spi_dma_send(uint16_t address, uint16_t data_len, uint8_t *data_buf)
 281:App/STM32F4-Discovery/spi.c **** {
 591              		.loc 1 281 0
 592              		.cfi_startproc
 593              		@ args = 0, pretend = 0, frame = 16
 594              		@ frame_needed = 1, uses_anonymous_args = 0
 595 0000 80B5     		push	{r7, lr}
 596              	.LCFI12:
 597              		.cfi_def_cfa_offset 8
 598              		.cfi_offset 7, -8
 599              		.cfi_offset 14, -4
 600 0002 84B0     		sub	sp, sp, #16
 601              	.LCFI13:
 602              		.cfi_def_cfa_offset 24
 603 0004 00AF     		add	r7, sp, #0
 604              	.LCFI14:
 605              		.cfi_def_cfa_register 7
 606 0006 0B46     		mov	r3, r1
 607 0008 3A60     		str	r2, [r7]
 608 000a 0246     		mov	r2, r0	@ movhi
 609 000c FA80     		strh	r2, [r7, #6]	@ movhi
 610 000e BB80     		strh	r3, [r7, #4]	@ movhi
 282:App/STM32F4-Discovery/spi.c **** 		CSON(); // chip select  
 611              		.loc 1 282 0
 612 0010 2C4B     		ldr	r3, .L31
 613 0012 2C4A     		ldr	r2, .L31
 614 0014 528B     		ldrh	r2, [r2, #26]	@ movhi
 615 0016 92B2     		uxth	r2, r2
 616 0018 42F01002 		orr	r2, r2, #16
 617 001c 92B2     		uxth	r2, r2
 618 001e 5A83     		strh	r2, [r3, #26]	@ movhi
 283:App/STM32F4-Discovery/spi.c **** 		bufferIndex = 0; 
 619              		.loc 1 283 0
 620 0020 294B     		ldr	r3, .L31+4
 621 0022 0022     		movs	r2, #0
 622 0024 1A60     		str	r2, [r3]
 284:App/STM32F4-Discovery/spi.c **** 		bufferTX[0] = ((address & 0xff00) >> 8); // addres byte 1 
 623              		.loc 1 284 0
 624 0026 FB88     		ldrh	r3, [r7, #6]
 625 0028 1B0A     		lsrs	r3, r3, #8
 626 002a 9BB2     		uxth	r3, r3
 627 002c DAB2     		uxtb	r2, r3
 628 002e 274B     		ldr	r3, .L31+8
 629 0030 1A70     		strb	r2, [r3]
 285:App/STM32F4-Discovery/spi.c **** 		bufferTX[1] = ((address & 0x00ff)); //address byte 2 
 630              		.loc 1 285 0
 631 0032 FB88     		ldrh	r3, [r7, #6]	@ movhi
 632 0034 DAB2     		uxtb	r2, r3
 633 0036 254B     		ldr	r3, .L31+8
 634 0038 5A70     		strb	r2, [r3, #1]
 286:App/STM32F4-Discovery/spi.c **** 		bufferTX[2] = ((0x80 | (data_len & 0x7f00) >> 8 ));
 635              		.loc 1 286 0
 636 003a BB88     		ldrh	r3, [r7, #4]
 637 003c 03F4FE43 		and	r3, r3, #32512
 638 0040 1B12     		asrs	r3, r3, #8
 639 0042 DBB2     		uxtb	r3, r3
 640 0044 63F07F03 		orn	r3, r3, #127
 641 0048 DBB2     		uxtb	r3, r3
 642 004a DAB2     		uxtb	r2, r3
 643 004c 1F4B     		ldr	r3, .L31+8
 644 004e 9A70     		strb	r2, [r3, #2]
 287:App/STM32F4-Discovery/spi.c **** 		bufferTX[3] = (data_len & 0x00ff);
 645              		.loc 1 287 0
 646 0050 BB88     		ldrh	r3, [r7, #4]	@ movhi
 647 0052 DAB2     		uxtb	r2, r3
 648 0054 1D4B     		ldr	r3, .L31+8
 649 0056 DA70     		strb	r2, [r3, #3]
 288:App/STM32F4-Discovery/spi.c **** 
 289:App/STM32F4-Discovery/spi.c **** 		int i;
 290:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len; i++) 
 650              		.loc 1 290 0
 651 0058 0423     		movs	r3, #4
 652 005a FB60     		str	r3, [r7, #12]
 653 005c 0BE0     		b	.L28
 654              	.L29:
 291:App/STM32F4-Discovery/spi.c **** 			bufferTX[i] = (data_buf[i-4]);
 655              		.loc 1 291 0 discriminator 2
 656 005e FB68     		ldr	r3, [r7, #12]
 657 0060 043B     		subs	r3, r3, #4
 658 0062 3A68     		ldr	r2, [r7]
 659 0064 1344     		add	r3, r3, r2
 660 0066 1A78     		ldrb	r2, [r3]	@ zero_extendqisi2
 661 0068 1849     		ldr	r1, .L31+8
 662 006a FB68     		ldr	r3, [r7, #12]
 663 006c 0B44     		add	r3, r3, r1
 664 006e 1A70     		strb	r2, [r3]
 290:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len; i++) 
 665              		.loc 1 290 0 discriminator 2
 666 0070 FB68     		ldr	r3, [r7, #12]
 667 0072 0133     		adds	r3, r3, #1
 668 0074 FB60     		str	r3, [r7, #12]
 669              	.L28:
 290:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len; i++) 
 670              		.loc 1 290 0 is_stmt 0 discriminator 1
 671 0076 BA88     		ldrh	r2, [r7, #4]
 672 0078 FB68     		ldr	r3, [r7, #12]
 673 007a 9A42     		cmp	r2, r3
 674 007c EFDC     		bgt	.L29
 292:App/STM32F4-Discovery/spi.c **** 		datalength = data_len + 4;
 675              		.loc 1 292 0 is_stmt 1
 676 007e BB88     		ldrh	r3, [r7, #4]
 677 0080 1A1D     		adds	r2, r3, #4
 678 0082 134B     		ldr	r3, .L31+12
 679 0084 1A60     		str	r2, [r3]
 293:App/STM32F4-Discovery/spi.c **** 	//	SPI_IRQHandler();
 294:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_TX_DMA_CHANNEL, datalength);
 680              		.loc 1 294 0
 681 0086 124B     		ldr	r3, .L31+12
 682 0088 1B68     		ldr	r3, [r3]
 683 008a 9BB2     		uxth	r3, r3
 684 008c 4FF0C060 		mov	r0, #100663296
 685 0090 1946     		mov	r1, r3
 686 0092 FFF7FEFF 		bl	DMA_SetCurrDataCounter
 295:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_TX_DMA_CHANNEL, ENABLE);	
 687              		.loc 1 295 0
 688 0096 4FF0C060 		mov	r0, #100663296
 689 009a 0121     		movs	r1, #1
 690 009c FFF7FEFF 		bl	DMA_Cmd
 296:App/STM32F4-Discovery/spi.c **** 		while(SPI_DMA_TX_IRQHandler());
 691              		.loc 1 296 0
 692 00a0 00BF     		nop
 693              	.L30:
 694              		.loc 1 296 0 is_stmt 0 discriminator 1
 695 00a2 FFF7FEFF 		bl	SPI_DMA_TX_IRQHandler
 696 00a6 0346     		mov	r3, r0
 697 00a8 002B     		cmp	r3, #0
 698 00aa FAD1     		bne	.L30
 297:App/STM32F4-Discovery/spi.c **** 		CSOFF(); // chip deselect 
 699              		.loc 1 297 0 is_stmt 1
 700 00ac 054B     		ldr	r3, .L31
 701 00ae 054A     		ldr	r2, .L31
 702 00b0 128B     		ldrh	r2, [r2, #24]	@ movhi
 703 00b2 92B2     		uxth	r2, r2
 704 00b4 42F01002 		orr	r2, r2, #16
 705 00b8 92B2     		uxth	r2, r2
 706 00ba 1A83     		strh	r2, [r3, #24]	@ movhi
 298:App/STM32F4-Discovery/spi.c **** 			
 299:App/STM32F4-Discovery/spi.c **** 	
 300:App/STM32F4-Discovery/spi.c **** }
 707              		.loc 1 300 0
 708 00bc 1037     		adds	r7, r7, #16
 709 00be BD46     		mov	sp, r7
 710              		@ sp needed
 711 00c0 80BD     		pop	{r7, pc}
 712              	.L32:
 713 00c2 00BF     		.align	2
 714              	.L31:
 715 00c4 00000240 		.word	1073872896
 716 00c8 00000000 		.word	bufferIndex
 717 00cc 00000000 		.word	bufferTX
 718 00d0 00000000 		.word	datalength
 719              		.cfi_endproc
 720              	.LFE115:
 722              		.section	.text.spi_send,"ax",%progbits
 723              		.align	2
 724              		.global	spi_send
 725              		.thumb
 726              		.thumb_func
 728              	spi_send:
 729              	.LFB116:
 301:App/STM32F4-Discovery/spi.c **** 
 302:App/STM32F4-Discovery/spi.c **** void spi_send(uint16_t address, uint16_t data_len, uint8_t *data_buf)
 303:App/STM32F4-Discovery/spi.c **** {
 730              		.loc 1 303 0
 731              		.cfi_startproc
 732              		@ args = 0, pretend = 0, frame = 16
 733              		@ frame_needed = 1, uses_anonymous_args = 0
 734 0000 80B5     		push	{r7, lr}
 735              	.LCFI15:
 736              		.cfi_def_cfa_offset 8
 737              		.cfi_offset 7, -8
 738              		.cfi_offset 14, -4
 739 0002 84B0     		sub	sp, sp, #16
 740              	.LCFI16:
 741              		.cfi_def_cfa_offset 24
 742 0004 00AF     		add	r7, sp, #0
 743              	.LCFI17:
 744              		.cfi_def_cfa_register 7
 745 0006 0B46     		mov	r3, r1
 746 0008 3A60     		str	r2, [r7]
 747 000a 0246     		mov	r2, r0	@ movhi
 748 000c FA80     		strh	r2, [r7, #6]	@ movhi
 749 000e BB80     		strh	r3, [r7, #4]	@ movhi
 304:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRH |= GPIO_Pin_4; // chip select  
 750              		.loc 1 304 0
 751 0010 204B     		ldr	r3, .L36
 752 0012 204A     		ldr	r2, .L36
 753 0014 528B     		ldrh	r2, [r2, #26]	@ movhi
 754 0016 92B2     		uxth	r2, r2
 755 0018 42F01002 		orr	r2, r2, #16
 756 001c 92B2     		uxth	r2, r2
 757 001e 5A83     		strh	r2, [r3, #26]	@ movhi
 305:App/STM32F4-Discovery/spi.c **** 		
 306:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0xff00) >> 8); // addres byte 1 
 758              		.loc 1 306 0
 759 0020 FB88     		ldrh	r3, [r7, #6]
 760 0022 1B0A     		lsrs	r3, r3, #8
 761 0024 9BB2     		uxth	r3, r3
 762 0026 DBB2     		uxtb	r3, r3
 763 0028 1846     		mov	r0, r3
 764 002a FFF7FEFF 		bl	SPI1_send
 307:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0x00ff)); //address byte 2 
 765              		.loc 1 307 0
 766 002e FB88     		ldrh	r3, [r7, #6]	@ movhi
 767 0030 DBB2     		uxtb	r3, r3
 768 0032 1846     		mov	r0, r3
 769 0034 FFF7FEFF 		bl	SPI1_send
 308:App/STM32F4-Discovery/spi.c **** 		SPI1_send((0x80 | (data_len & 0x7f00) >> 8 ));
 770              		.loc 1 308 0
 771 0038 BB88     		ldrh	r3, [r7, #4]
 772 003a 03F4FE43 		and	r3, r3, #32512
 773 003e 1B12     		asrs	r3, r3, #8
 774 0040 DBB2     		uxtb	r3, r3
 775 0042 63F07F03 		orn	r3, r3, #127
 776 0046 DBB2     		uxtb	r3, r3
 777 0048 DBB2     		uxtb	r3, r3
 778 004a 1846     		mov	r0, r3
 779 004c FFF7FEFF 		bl	SPI1_send
 309:App/STM32F4-Discovery/spi.c **** 		SPI1_send(data_len & 0x00ff);
 780              		.loc 1 309 0
 781 0050 BB88     		ldrh	r3, [r7, #4]	@ movhi
 782 0052 DBB2     		uxtb	r3, r3
 783 0054 1846     		mov	r0, r3
 784 0056 FFF7FEFF 		bl	SPI1_send
 310:App/STM32F4-Discovery/spi.c **** 
 311:App/STM32F4-Discovery/spi.c **** 		int i;
 312:App/STM32F4-Discovery/spi.c **** 		for (i = 0; i < data_len; i++) SPI1_send(data_buf[i]);
 785              		.loc 1 312 0
 786 005a 0023     		movs	r3, #0
 787 005c FB60     		str	r3, [r7, #12]
 788 005e 09E0     		b	.L34
 789              	.L35:
 790              		.loc 1 312 0 is_stmt 0 discriminator 2
 791 0060 FB68     		ldr	r3, [r7, #12]
 792 0062 3A68     		ldr	r2, [r7]
 793 0064 1344     		add	r3, r3, r2
 794 0066 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 795 0068 1846     		mov	r0, r3
 796 006a FFF7FEFF 		bl	SPI1_send
 797 006e FB68     		ldr	r3, [r7, #12]
 798 0070 0133     		adds	r3, r3, #1
 799 0072 FB60     		str	r3, [r7, #12]
 800              	.L34:
 801              		.loc 1 312 0 discriminator 1
 802 0074 BA88     		ldrh	r2, [r7, #4]
 803 0076 FB68     		ldr	r3, [r7, #12]
 804 0078 9A42     		cmp	r2, r3
 805 007a F1DC     		bgt	.L35
 313:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRL |= GPIO_Pin_4; // chip deselect 
 806              		.loc 1 313 0 is_stmt 1
 807 007c 054B     		ldr	r3, .L36
 808 007e 054A     		ldr	r2, .L36
 809 0080 128B     		ldrh	r2, [r2, #24]	@ movhi
 810 0082 92B2     		uxth	r2, r2
 811 0084 42F01002 		orr	r2, r2, #16
 812 0088 92B2     		uxth	r2, r2
 813 008a 1A83     		strh	r2, [r3, #24]	@ movhi
 314:App/STM32F4-Discovery/spi.c **** 			
 315:App/STM32F4-Discovery/spi.c **** 	
 316:App/STM32F4-Discovery/spi.c **** }
 814              		.loc 1 316 0
 815 008c 1037     		adds	r7, r7, #16
 816 008e BD46     		mov	sp, r7
 817              		@ sp needed
 818 0090 80BD     		pop	{r7, pc}
 819              	.L37:
 820 0092 00BF     		.align	2
 821              	.L36:
 822 0094 00000240 		.word	1073872896
 823              		.cfi_endproc
 824              	.LFE116:
 826              		.section	.text.spi_send2B,"ax",%progbits
 827              		.align	2
 828              		.global	spi_send2B
 829              		.thumb
 830              		.thumb_func
 832              	spi_send2B:
 833              	.LFB117:
 317:App/STM32F4-Discovery/spi.c **** 
 318:App/STM32F4-Discovery/spi.c **** void spi_send2B(uint16_t address,  uint16_t data_buf)
 319:App/STM32F4-Discovery/spi.c **** {
 834              		.loc 1 319 0
 835              		.cfi_startproc
 836              		@ args = 0, pretend = 0, frame = 16
 837              		@ frame_needed = 1, uses_anonymous_args = 0
 838 0000 80B5     		push	{r7, lr}
 839              	.LCFI18:
 840              		.cfi_def_cfa_offset 8
 841              		.cfi_offset 7, -8
 842              		.cfi_offset 14, -4
 843 0002 84B0     		sub	sp, sp, #16
 844              	.LCFI19:
 845              		.cfi_def_cfa_offset 24
 846 0004 00AF     		add	r7, sp, #0
 847              	.LCFI20:
 848              		.cfi_def_cfa_register 7
 849 0006 0246     		mov	r2, r0
 850 0008 0B46     		mov	r3, r1
 851 000a FA80     		strh	r2, [r7, #6]	@ movhi
 852 000c BB80     		strh	r3, [r7, #4]	@ movhi
 320:App/STM32F4-Discovery/spi.c **** 		int16_t data_len = 2; 
 853              		.loc 1 320 0
 854 000e 0223     		movs	r3, #2
 855 0010 FB81     		strh	r3, [r7, #14]	@ movhi
 321:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRH |= GPIO_Pin_4; // chip select  
 856              		.loc 1 321 0
 857 0012 1E4B     		ldr	r3, .L39
 858 0014 1D4A     		ldr	r2, .L39
 859 0016 528B     		ldrh	r2, [r2, #26]	@ movhi
 860 0018 92B2     		uxth	r2, r2
 861 001a 42F01002 		orr	r2, r2, #16
 862 001e 92B2     		uxth	r2, r2
 863 0020 5A83     		strh	r2, [r3, #26]	@ movhi
 322:App/STM32F4-Discovery/spi.c **** 		
 323:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0xff00) >> 8); // addres byte 1 
 864              		.loc 1 323 0
 865 0022 FB88     		ldrh	r3, [r7, #6]
 866 0024 1B0A     		lsrs	r3, r3, #8
 867 0026 9BB2     		uxth	r3, r3
 868 0028 DBB2     		uxtb	r3, r3
 869 002a 1846     		mov	r0, r3
 870 002c FFF7FEFF 		bl	SPI1_send
 324:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0x00ff)); //address byte 2 
 871              		.loc 1 324 0
 872 0030 FB88     		ldrh	r3, [r7, #6]	@ movhi
 873 0032 DBB2     		uxtb	r3, r3
 874 0034 1846     		mov	r0, r3
 875 0036 FFF7FEFF 		bl	SPI1_send
 325:App/STM32F4-Discovery/spi.c **** 		SPI1_send((0x80 | (data_len & 0x7f00) >> 8 ));
 876              		.loc 1 325 0
 877 003a FB89     		ldrh	r3, [r7, #14]
 878 003c 03F4FE43 		and	r3, r3, #32512
 879 0040 1B12     		asrs	r3, r3, #8
 880 0042 DBB2     		uxtb	r3, r3
 881 0044 63F07F03 		orn	r3, r3, #127
 882 0048 DBB2     		uxtb	r3, r3
 883 004a DBB2     		uxtb	r3, r3
 884 004c 1846     		mov	r0, r3
 885 004e FFF7FEFF 		bl	SPI1_send
 326:App/STM32F4-Discovery/spi.c **** 		SPI1_send(data_len & 0x00ff);
 886              		.loc 1 326 0
 887 0052 FB89     		ldrh	r3, [r7, #14]	@ movhi
 888 0054 DBB2     		uxtb	r3, r3
 889 0056 1846     		mov	r0, r3
 890 0058 FFF7FEFF 		bl	SPI1_send
 327:App/STM32F4-Discovery/spi.c **** 
 328:App/STM32F4-Discovery/spi.c **** 		SPI1_send((data_buf & 0xff00) >> 8);
 891              		.loc 1 328 0
 892 005c BB88     		ldrh	r3, [r7, #4]
 893 005e 1B0A     		lsrs	r3, r3, #8
 894 0060 9BB2     		uxth	r3, r3
 895 0062 DBB2     		uxtb	r3, r3
 896 0064 1846     		mov	r0, r3
 897 0066 FFF7FEFF 		bl	SPI1_send
 329:App/STM32F4-Discovery/spi.c **** 		SPI1_send(data_buf & 0x00ff);
 898              		.loc 1 329 0
 899 006a BB88     		ldrh	r3, [r7, #4]	@ movhi
 900 006c DBB2     		uxtb	r3, r3
 901 006e 1846     		mov	r0, r3
 902 0070 FFF7FEFF 		bl	SPI1_send
 330:App/STM32F4-Discovery/spi.c **** 
 331:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRL |= GPIO_Pin_4; // chip deselect 
 903              		.loc 1 331 0
 904 0074 054B     		ldr	r3, .L39
 905 0076 054A     		ldr	r2, .L39
 906 0078 128B     		ldrh	r2, [r2, #24]	@ movhi
 907 007a 92B2     		uxth	r2, r2
 908 007c 42F01002 		orr	r2, r2, #16
 909 0080 92B2     		uxth	r2, r2
 910 0082 1A83     		strh	r2, [r3, #24]	@ movhi
 332:App/STM32F4-Discovery/spi.c **** 			
 333:App/STM32F4-Discovery/spi.c **** 	
 334:App/STM32F4-Discovery/spi.c **** }
 911              		.loc 1 334 0
 912 0084 1037     		adds	r7, r7, #16
 913 0086 BD46     		mov	sp, r7
 914              		@ sp needed
 915 0088 80BD     		pop	{r7, pc}
 916              	.L40:
 917 008a 00BF     		.align	2
 918              	.L39:
 919 008c 00000240 		.word	1073872896
 920              		.cfi_endproc
 921              	.LFE117:
 923              		.section	.text.spi_sendByte,"ax",%progbits
 924              		.align	2
 925              		.global	spi_sendByte
 926              		.thumb
 927              		.thumb_func
 929              	spi_sendByte:
 930              	.LFB118:
 335:App/STM32F4-Discovery/spi.c **** 
 336:App/STM32F4-Discovery/spi.c **** 
 337:App/STM32F4-Discovery/spi.c **** void spi_sendByte(uint16_t address,  uint8_t data_buf)
 338:App/STM32F4-Discovery/spi.c **** {
 931              		.loc 1 338 0
 932              		.cfi_startproc
 933              		@ args = 0, pretend = 0, frame = 16
 934              		@ frame_needed = 1, uses_anonymous_args = 0
 935 0000 80B5     		push	{r7, lr}
 936              	.LCFI21:
 937              		.cfi_def_cfa_offset 8
 938              		.cfi_offset 7, -8
 939              		.cfi_offset 14, -4
 940 0002 84B0     		sub	sp, sp, #16
 941              	.LCFI22:
 942              		.cfi_def_cfa_offset 24
 943 0004 00AF     		add	r7, sp, #0
 944              	.LCFI23:
 945              		.cfi_def_cfa_register 7
 946 0006 0246     		mov	r2, r0
 947 0008 0B46     		mov	r3, r1
 948 000a FA80     		strh	r2, [r7, #6]	@ movhi
 949 000c 7B71     		strb	r3, [r7, #5]
 339:App/STM32F4-Discovery/spi.c **** 		int16_t data_len = 1; 
 950              		.loc 1 339 0
 951 000e 0123     		movs	r3, #1
 952 0010 FB81     		strh	r3, [r7, #14]	@ movhi
 340:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRH |= GPIO_Pin_4; // chip select  
 953              		.loc 1 340 0
 954 0012 1A4B     		ldr	r3, .L42
 955 0014 194A     		ldr	r2, .L42
 956 0016 528B     		ldrh	r2, [r2, #26]	@ movhi
 957 0018 92B2     		uxth	r2, r2
 958 001a 42F01002 		orr	r2, r2, #16
 959 001e 92B2     		uxth	r2, r2
 960 0020 5A83     		strh	r2, [r3, #26]	@ movhi
 341:App/STM32F4-Discovery/spi.c **** 		
 342:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0xff00) >> 8); // addres byte 1 
 961              		.loc 1 342 0
 962 0022 FB88     		ldrh	r3, [r7, #6]
 963 0024 1B0A     		lsrs	r3, r3, #8
 964 0026 9BB2     		uxth	r3, r3
 965 0028 DBB2     		uxtb	r3, r3
 966 002a 1846     		mov	r0, r3
 967 002c FFF7FEFF 		bl	SPI1_send
 343:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0x00ff)); //address byte 2 
 968              		.loc 1 343 0
 969 0030 FB88     		ldrh	r3, [r7, #6]	@ movhi
 970 0032 DBB2     		uxtb	r3, r3
 971 0034 1846     		mov	r0, r3
 972 0036 FFF7FEFF 		bl	SPI1_send
 344:App/STM32F4-Discovery/spi.c **** 		SPI1_send((0x80 | (data_len & 0x7f00) >> 8 ));
 973              		.loc 1 344 0
 974 003a FB89     		ldrh	r3, [r7, #14]
 975 003c 03F4FE43 		and	r3, r3, #32512
 976 0040 1B12     		asrs	r3, r3, #8
 977 0042 DBB2     		uxtb	r3, r3
 978 0044 63F07F03 		orn	r3, r3, #127
 979 0048 DBB2     		uxtb	r3, r3
 980 004a DBB2     		uxtb	r3, r3
 981 004c 1846     		mov	r0, r3
 982 004e FFF7FEFF 		bl	SPI1_send
 345:App/STM32F4-Discovery/spi.c **** 		SPI1_send(data_len & 0x00ff);
 983              		.loc 1 345 0
 984 0052 FB89     		ldrh	r3, [r7, #14]	@ movhi
 985 0054 DBB2     		uxtb	r3, r3
 986 0056 1846     		mov	r0, r3
 987 0058 FFF7FEFF 		bl	SPI1_send
 346:App/STM32F4-Discovery/spi.c **** 
 347:App/STM32F4-Discovery/spi.c **** 		SPI1_send(data_buf);
 988              		.loc 1 347 0
 989 005c 7B79     		ldrb	r3, [r7, #5]	@ zero_extendqisi2
 990 005e 1846     		mov	r0, r3
 991 0060 FFF7FEFF 		bl	SPI1_send
 348:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRL |= GPIO_Pin_4; // chip deselect 
 992              		.loc 1 348 0
 993 0064 054B     		ldr	r3, .L42
 994 0066 054A     		ldr	r2, .L42
 995 0068 128B     		ldrh	r2, [r2, #24]	@ movhi
 996 006a 92B2     		uxth	r2, r2
 997 006c 42F01002 		orr	r2, r2, #16
 998 0070 92B2     		uxth	r2, r2
 999 0072 1A83     		strh	r2, [r3, #24]	@ movhi
 349:App/STM32F4-Discovery/spi.c **** 			
 350:App/STM32F4-Discovery/spi.c **** 	
 351:App/STM32F4-Discovery/spi.c **** }
 1000              		.loc 1 351 0
 1001 0074 1037     		adds	r7, r7, #16
 1002 0076 BD46     		mov	sp, r7
 1003              		@ sp needed
 1004 0078 80BD     		pop	{r7, pc}
 1005              	.L43:
 1006 007a 00BF     		.align	2
 1007              	.L42:
 1008 007c 00000240 		.word	1073872896
 1009              		.cfi_endproc
 1010              	.LFE118:
 1012              		.section	.text.spi_read2B,"ax",%progbits
 1013              		.align	2
 1014              		.global	spi_read2B
 1015              		.thumb
 1016              		.thumb_func
 1018              	spi_read2B:
 1019              	.LFB119:
 352:App/STM32F4-Discovery/spi.c **** 
 353:App/STM32F4-Discovery/spi.c **** 
 354:App/STM32F4-Discovery/spi.c **** uint16_t spi_read2B(uint16_t address)
 355:App/STM32F4-Discovery/spi.c **** {
 1020              		.loc 1 355 0
 1021              		.cfi_startproc
 1022              		@ args = 0, pretend = 0, frame = 16
 1023              		@ frame_needed = 1, uses_anonymous_args = 0
 1024 0000 80B5     		push	{r7, lr}
 1025              	.LCFI24:
 1026              		.cfi_def_cfa_offset 8
 1027              		.cfi_offset 7, -8
 1028              		.cfi_offset 14, -4
 1029 0002 84B0     		sub	sp, sp, #16
 1030              	.LCFI25:
 1031              		.cfi_def_cfa_offset 24
 1032 0004 00AF     		add	r7, sp, #0
 1033              	.LCFI26:
 1034              		.cfi_def_cfa_register 7
 1035 0006 0346     		mov	r3, r0
 1036 0008 FB80     		strh	r3, [r7, #6]	@ movhi
 356:App/STM32F4-Discovery/spi.c **** 		uint16_t data_len = 2; 
 1037              		.loc 1 356 0
 1038 000a 0223     		movs	r3, #2
 1039 000c 7B81     		strh	r3, [r7, #10]	@ movhi
 357:App/STM32F4-Discovery/spi.c **** 		uint8_t data_buf[2];
 358:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRH |= GPIO_Pin_4; // chip select  
 1040              		.loc 1 358 0
 1041 000e 244B     		ldr	r3, .L48
 1042 0010 234A     		ldr	r2, .L48
 1043 0012 528B     		ldrh	r2, [r2, #26]	@ movhi
 1044 0014 92B2     		uxth	r2, r2
 1045 0016 42F01002 		orr	r2, r2, #16
 1046 001a 92B2     		uxth	r2, r2
 1047 001c 5A83     		strh	r2, [r3, #26]	@ movhi
 359:App/STM32F4-Discovery/spi.c **** 		
 360:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0xff00) >> 8); // addres byte 1 
 1048              		.loc 1 360 0
 1049 001e FB88     		ldrh	r3, [r7, #6]
 1050 0020 1B0A     		lsrs	r3, r3, #8
 1051 0022 9BB2     		uxth	r3, r3
 1052 0024 DBB2     		uxtb	r3, r3
 1053 0026 1846     		mov	r0, r3
 1054 0028 FFF7FEFF 		bl	SPI1_send
 361:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0x00ff)); //address byte 2 
 1055              		.loc 1 361 0
 1056 002c FB88     		ldrh	r3, [r7, #6]	@ movhi
 1057 002e DBB2     		uxtb	r3, r3
 1058 0030 1846     		mov	r0, r3
 1059 0032 FFF7FEFF 		bl	SPI1_send
 362:App/STM32F4-Discovery/spi.c **** 		SPI1_send((0x00 | (data_len & 0x7f00) >> 8 ));
 1060              		.loc 1 362 0
 1061 0036 7B89     		ldrh	r3, [r7, #10]
 1062 0038 03F4FE43 		and	r3, r3, #32512
 1063 003c 1B12     		asrs	r3, r3, #8
 1064 003e DBB2     		uxtb	r3, r3
 1065 0040 1846     		mov	r0, r3
 1066 0042 FFF7FEFF 		bl	SPI1_send
 363:App/STM32F4-Discovery/spi.c **** 		SPI1_send(data_len & 0x00ff);
 1067              		.loc 1 363 0
 1068 0046 7B89     		ldrh	r3, [r7, #10]	@ movhi
 1069 0048 DBB2     		uxtb	r3, r3
 1070 004a 1846     		mov	r0, r3
 1071 004c FFF7FEFF 		bl	SPI1_send
 364:App/STM32F4-Discovery/spi.c **** 
 365:App/STM32F4-Discovery/spi.c **** 		int i;
 366:App/STM32F4-Discovery/spi.c **** 		for (i = 0; i < data_len; i++)
 1072              		.loc 1 366 0
 1073 0050 0023     		movs	r3, #0
 1074 0052 FB60     		str	r3, [r7, #12]
 1075 0054 0BE0     		b	.L45
 1076              	.L46:
 367:App/STM32F4-Discovery/spi.c **** 		{
 368:App/STM32F4-Discovery/spi.c **** 		
 369:App/STM32F4-Discovery/spi.c **** 			 data_buf[i] = SPI1_recive();
 1077              		.loc 1 369 0 discriminator 2
 1078 0056 FFF7FEFF 		bl	SPI1_recive
 1079 005a 0346     		mov	r3, r0
 1080 005c 1A46     		mov	r2, r3
 1081 005e 07F10801 		add	r1, r7, #8
 1082 0062 FB68     		ldr	r3, [r7, #12]
 1083 0064 0B44     		add	r3, r3, r1
 1084 0066 1A70     		strb	r2, [r3]
 366:App/STM32F4-Discovery/spi.c **** 		for (i = 0; i < data_len; i++)
 1085              		.loc 1 366 0 discriminator 2
 1086 0068 FB68     		ldr	r3, [r7, #12]
 1087 006a 0133     		adds	r3, r3, #1
 1088 006c FB60     		str	r3, [r7, #12]
 1089              	.L45:
 366:App/STM32F4-Discovery/spi.c **** 		for (i = 0; i < data_len; i++)
 1090              		.loc 1 366 0 is_stmt 0 discriminator 1
 1091 006e 7A89     		ldrh	r2, [r7, #10]
 1092 0070 FB68     		ldr	r3, [r7, #12]
 1093 0072 9A42     		cmp	r2, r3
 1094 0074 EFDC     		bgt	.L46
 370:App/STM32F4-Discovery/spi.c **** 			
 371:App/STM32F4-Discovery/spi.c **** 		}
 372:App/STM32F4-Discovery/spi.c **** 
 373:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRL |= GPIO_Pin_4; // chip deselect 
 1095              		.loc 1 373 0 is_stmt 1
 1096 0076 0A4B     		ldr	r3, .L48
 1097 0078 094A     		ldr	r2, .L48
 1098 007a 128B     		ldrh	r2, [r2, #24]	@ movhi
 1099 007c 92B2     		uxth	r2, r2
 1100 007e 42F01002 		orr	r2, r2, #16
 1101 0082 92B2     		uxth	r2, r2
 1102 0084 1A83     		strh	r2, [r3, #24]	@ movhi
 374:App/STM32F4-Discovery/spi.c **** 		
 375:App/STM32F4-Discovery/spi.c **** 		data_len = 0x0000;
 1103              		.loc 1 375 0
 1104 0086 0023     		movs	r3, #0
 1105 0088 7B81     		strh	r3, [r7, #10]	@ movhi
 376:App/STM32F4-Discovery/spi.c **** 		return (data_buf[0] << 8) | data_buf[1];
 1106              		.loc 1 376 0
 1107 008a 3B7A     		ldrb	r3, [r7, #8]	@ zero_extendqisi2
 1108 008c 1B02     		lsls	r3, r3, #8
 1109 008e 9AB2     		uxth	r2, r3
 1110 0090 7B7A     		ldrb	r3, [r7, #9]	@ zero_extendqisi2
 1111 0092 1343     		orrs	r3, r3, r2
 1112 0094 9BB2     		uxth	r3, r3
 1113 0096 9BB2     		uxth	r3, r3
 377:App/STM32F4-Discovery/spi.c **** 
 378:App/STM32F4-Discovery/spi.c **** }
 1114              		.loc 1 378 0
 1115 0098 1846     		mov	r0, r3
 1116 009a 1037     		adds	r7, r7, #16
 1117 009c BD46     		mov	sp, r7
 1118              		@ sp needed
 1119 009e 80BD     		pop	{r7, pc}
 1120              	.L49:
 1121              		.align	2
 1122              	.L48:
 1123 00a0 00000240 		.word	1073872896
 1124              		.cfi_endproc
 1125              	.LFE119:
 1127              		.section	.text.spi_read,"ax",%progbits
 1128              		.align	2
 1129              		.global	spi_read
 1130              		.thumb
 1131              		.thumb_func
 1133              	spi_read:
 1134              	.LFB120:
 379:App/STM32F4-Discovery/spi.c **** void spi_read(uint16_t address, uint16_t data_len, uint8_t *data_buf)
 380:App/STM32F4-Discovery/spi.c **** {
 1135              		.loc 1 380 0
 1136              		.cfi_startproc
 1137              		@ args = 0, pretend = 0, frame = 16
 1138              		@ frame_needed = 1, uses_anonymous_args = 0
 1139 0000 90B5     		push	{r4, r7, lr}
 1140              	.LCFI27:
 1141              		.cfi_def_cfa_offset 12
 1142              		.cfi_offset 4, -12
 1143              		.cfi_offset 7, -8
 1144              		.cfi_offset 14, -4
 1145 0002 85B0     		sub	sp, sp, #20
 1146              	.LCFI28:
 1147              		.cfi_def_cfa_offset 32
 1148 0004 00AF     		add	r7, sp, #0
 1149              	.LCFI29:
 1150              		.cfi_def_cfa_register 7
 1151 0006 0B46     		mov	r3, r1
 1152 0008 3A60     		str	r2, [r7]
 1153 000a 0246     		mov	r2, r0	@ movhi
 1154 000c FA80     		strh	r2, [r7, #6]	@ movhi
 1155 000e BB80     		strh	r3, [r7, #4]	@ movhi
 381:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRH |= GPIO_Pin_4; // chip select  
 1156              		.loc 1 381 0
 1157 0010 1E4B     		ldr	r3, .L53
 1158 0012 1E4A     		ldr	r2, .L53
 1159 0014 528B     		ldrh	r2, [r2, #26]	@ movhi
 1160 0016 92B2     		uxth	r2, r2
 1161 0018 42F01002 		orr	r2, r2, #16
 1162 001c 92B2     		uxth	r2, r2
 1163 001e 5A83     		strh	r2, [r3, #26]	@ movhi
 382:App/STM32F4-Discovery/spi.c **** 		
 383:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0xff00) >> 8); // addres byte 1 
 1164              		.loc 1 383 0
 1165 0020 FB88     		ldrh	r3, [r7, #6]
 1166 0022 1B0A     		lsrs	r3, r3, #8
 1167 0024 9BB2     		uxth	r3, r3
 1168 0026 DBB2     		uxtb	r3, r3
 1169 0028 1846     		mov	r0, r3
 1170 002a FFF7FEFF 		bl	SPI1_send
 384:App/STM32F4-Discovery/spi.c **** 		SPI1_send((address & 0x00ff)); //address byte 2 
 1171              		.loc 1 384 0
 1172 002e FB88     		ldrh	r3, [r7, #6]	@ movhi
 1173 0030 DBB2     		uxtb	r3, r3
 1174 0032 1846     		mov	r0, r3
 1175 0034 FFF7FEFF 		bl	SPI1_send
 385:App/STM32F4-Discovery/spi.c **** 		SPI1_send((0x00 | (data_len & 0x7f00) >> 8 ));
 1176              		.loc 1 385 0
 1177 0038 BB88     		ldrh	r3, [r7, #4]
 1178 003a 03F4FE43 		and	r3, r3, #32512
 1179 003e 1B12     		asrs	r3, r3, #8
 1180 0040 DBB2     		uxtb	r3, r3
 1181 0042 1846     		mov	r0, r3
 1182 0044 FFF7FEFF 		bl	SPI1_send
 386:App/STM32F4-Discovery/spi.c **** 		SPI1_send(data_len & 0x00ff);
 1183              		.loc 1 386 0
 1184 0048 BB88     		ldrh	r3, [r7, #4]	@ movhi
 1185 004a DBB2     		uxtb	r3, r3
 1186 004c 1846     		mov	r0, r3
 1187 004e FFF7FEFF 		bl	SPI1_send
 387:App/STM32F4-Discovery/spi.c **** 
 388:App/STM32F4-Discovery/spi.c **** 		int i;
 389:App/STM32F4-Discovery/spi.c **** 		for (i = 0; i < data_len; i++)
 1188              		.loc 1 389 0
 1189 0052 0023     		movs	r3, #0
 1190 0054 FB60     		str	r3, [r7, #12]
 1191 0056 09E0     		b	.L51
 1192              	.L52:
 390:App/STM32F4-Discovery/spi.c **** 		{
 391:App/STM32F4-Discovery/spi.c **** 		
 392:App/STM32F4-Discovery/spi.c **** 			 data_buf[i] = SPI1_recive();
 1193              		.loc 1 392 0 discriminator 2
 1194 0058 FB68     		ldr	r3, [r7, #12]
 1195 005a 3A68     		ldr	r2, [r7]
 1196 005c D418     		adds	r4, r2, r3
 1197 005e FFF7FEFF 		bl	SPI1_recive
 1198 0062 0346     		mov	r3, r0
 1199 0064 2370     		strb	r3, [r4]
 389:App/STM32F4-Discovery/spi.c **** 		for (i = 0; i < data_len; i++)
 1200              		.loc 1 389 0 discriminator 2
 1201 0066 FB68     		ldr	r3, [r7, #12]
 1202 0068 0133     		adds	r3, r3, #1
 1203 006a FB60     		str	r3, [r7, #12]
 1204              	.L51:
 389:App/STM32F4-Discovery/spi.c **** 		for (i = 0; i < data_len; i++)
 1205              		.loc 1 389 0 is_stmt 0 discriminator 1
 1206 006c BA88     		ldrh	r2, [r7, #4]
 1207 006e FB68     		ldr	r3, [r7, #12]
 1208 0070 9A42     		cmp	r2, r3
 1209 0072 F1DC     		bgt	.L52
 393:App/STM32F4-Discovery/spi.c **** 			
 394:App/STM32F4-Discovery/spi.c **** 		}
 395:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRL |= GPIO_Pin_4; // chip deselect 
 1210              		.loc 1 395 0 is_stmt 1
 1211 0074 054B     		ldr	r3, .L53
 1212 0076 054A     		ldr	r2, .L53
 1213 0078 128B     		ldrh	r2, [r2, #24]	@ movhi
 1214 007a 92B2     		uxth	r2, r2
 1215 007c 42F01002 		orr	r2, r2, #16
 1216 0080 92B2     		uxth	r2, r2
 1217 0082 1A83     		strh	r2, [r3, #24]	@ movhi
 396:App/STM32F4-Discovery/spi.c **** 			
 397:App/STM32F4-Discovery/spi.c **** 	
 398:App/STM32F4-Discovery/spi.c **** }
 1218              		.loc 1 398 0
 1219 0084 1437     		adds	r7, r7, #20
 1220 0086 BD46     		mov	sp, r7
 1221              		@ sp needed
 1222 0088 90BD     		pop	{r4, r7, pc}
 1223              	.L54:
 1224 008a 00BF     		.align	2
 1225              	.L53:
 1226 008c 00000240 		.word	1073872896
 1227              		.cfi_endproc
 1228              	.LFE120:
 1230              		.section	.text.spi_master_transfer,"ax",%progbits
 1231              		.align	2
 1232              		.global	spi_master_transfer
 1233              		.thumb
 1234              		.thumb_func
 1236              	spi_master_transfer:
 1237              	.LFB121:
 399:App/STM32F4-Discovery/spi.c **** int spi_master_transfer(uint32_t spiport, uint8_t *cmdbuff, uint8_t cmdbufflen, uint8_t *data, uint
 400:App/STM32F4-Discovery/spi.c **** {
 1238              		.loc 1 400 0
 1239              		.cfi_startproc
 1240              		@ args = 4, pretend = 0, frame = 24
 1241              		@ frame_needed = 1, uses_anonymous_args = 0
 1242 0000 80B5     		push	{r7, lr}
 1243              	.LCFI30:
 1244              		.cfi_def_cfa_offset 8
 1245              		.cfi_offset 7, -8
 1246              		.cfi_offset 14, -4
 1247 0002 86B0     		sub	sp, sp, #24
 1248              	.LCFI31:
 1249              		.cfi_def_cfa_offset 32
 1250 0004 00AF     		add	r7, sp, #0
 1251              	.LCFI32:
 1252              		.cfi_def_cfa_register 7
 1253 0006 F860     		str	r0, [r7, #12]
 1254 0008 B960     		str	r1, [r7, #8]
 1255 000a 3B60     		str	r3, [r7]
 1256 000c 1346     		mov	r3, r2
 1257 000e FB71     		strb	r3, [r7, #7]
 401:App/STM32F4-Discovery/spi.c **** 	
 402:App/STM32F4-Discovery/spi.c **** 	uint8_t idx, d;
 403:App/STM32F4-Discovery/spi.c **** 	// sending data  
 404:App/STM32F4-Discovery/spi.c **** 	if (datalen == 0)
 1258              		.loc 1 404 0
 1259 0010 97F82030 		ldrb	r3, [r7, #32]	@ zero_extendqisi2
 1260 0014 002B     		cmp	r3, #0
 1261 0016 34D1     		bne	.L56
 405:App/STM32F4-Discovery/spi.c **** 	{
 406:App/STM32F4-Discovery/spi.c **** 		
 407:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRH |= GPIO_Pin_4; // chip select  
 1262              		.loc 1 407 0
 1263 0018 2E4B     		ldr	r3, .L64
 1264 001a 2E4A     		ldr	r2, .L64
 1265 001c 528B     		ldrh	r2, [r2, #26]	@ movhi
 1266 001e 92B2     		uxth	r2, r2
 1267 0020 42F01002 		orr	r2, r2, #16
 1268 0024 92B2     		uxth	r2, r2
 1269 0026 5A83     		strh	r2, [r3, #26]	@ movhi
 408:App/STM32F4-Discovery/spi.c **** 		
 409:App/STM32F4-Discovery/spi.c **** 		for (idx = 0; idx < cmdbufflen; idx++)
 1270              		.loc 1 409 0
 1271 0028 0023     		movs	r3, #0
 1272 002a FB75     		strb	r3, [r7, #23]
 1273 002c 09E0     		b	.L57
 1274              	.L58:
 410:App/STM32F4-Discovery/spi.c **** 		{
 411:App/STM32F4-Discovery/spi.c **** 			SPI1_send(cmdbuff[idx]);
 1275              		.loc 1 411 0 discriminator 2
 1276 002e FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 1277 0030 BA68     		ldr	r2, [r7, #8]
 1278 0032 1344     		add	r3, r3, r2
 1279 0034 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1280 0036 1846     		mov	r0, r3
 1281 0038 FFF7FEFF 		bl	SPI1_send
 409:App/STM32F4-Discovery/spi.c **** 		for (idx = 0; idx < cmdbufflen; idx++)
 1282              		.loc 1 409 0 discriminator 2
 1283 003c FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 1284 003e 0133     		adds	r3, r3, #1
 1285 0040 FB75     		strb	r3, [r7, #23]
 1286              	.L57:
 409:App/STM32F4-Discovery/spi.c **** 		for (idx = 0; idx < cmdbufflen; idx++)
 1287              		.loc 1 409 0 is_stmt 0 discriminator 1
 1288 0042 FA7D     		ldrb	r2, [r7, #23]	@ zero_extendqisi2
 1289 0044 FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 1290 0046 9A42     		cmp	r2, r3
 1291 0048 F1D3     		bcc	.L58
 412:App/STM32F4-Discovery/spi.c **** 		}
 413:App/STM32F4-Discovery/spi.c **** 		for (idx = 0; idx < datalen; idx++)
 1292              		.loc 1 413 0 is_stmt 1
 1293 004a 0023     		movs	r3, #0
 1294 004c FB75     		strb	r3, [r7, #23]
 1295 004e 09E0     		b	.L59
 1296              	.L60:
 414:App/STM32F4-Discovery/spi.c **** 		{
 415:App/STM32F4-Discovery/spi.c **** 			 SPI1_send(data[idx]);
 1297              		.loc 1 415 0 discriminator 2
 1298 0050 FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 1299 0052 3A68     		ldr	r2, [r7]
 1300 0054 1344     		add	r3, r3, r2
 1301 0056 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1302 0058 1846     		mov	r0, r3
 1303 005a FFF7FEFF 		bl	SPI1_send
 413:App/STM32F4-Discovery/spi.c **** 		for (idx = 0; idx < datalen; idx++)
 1304              		.loc 1 413 0 discriminator 2
 1305 005e FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 1306 0060 0133     		adds	r3, r3, #1
 1307 0062 FB75     		strb	r3, [r7, #23]
 1308              	.L59:
 413:App/STM32F4-Discovery/spi.c **** 		for (idx = 0; idx < datalen; idx++)
 1309              		.loc 1 413 0 is_stmt 0 discriminator 1
 1310 0064 FA7D     		ldrb	r2, [r7, #23]	@ zero_extendqisi2
 1311 0066 97F82030 		ldrb	r3, [r7, #32]	@ zero_extendqisi2
 1312 006a 9A42     		cmp	r2, r3
 1313 006c F0D3     		bcc	.L60
 416:App/STM32F4-Discovery/spi.c **** 		}
 417:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRL |= GPIO_Pin_4; // chip deselect 
 1314              		.loc 1 417 0 is_stmt 1
 1315 006e 194B     		ldr	r3, .L64
 1316 0070 184A     		ldr	r2, .L64
 1317 0072 128B     		ldrh	r2, [r2, #24]	@ movhi
 1318 0074 92B2     		uxth	r2, r2
 1319 0076 42F01002 		orr	r2, r2, #16
 1320 007a 92B2     		uxth	r2, r2
 1321 007c 1A83     		strh	r2, [r3, #24]	@ movhi
 418:App/STM32F4-Discovery/spi.c **** 
 419:App/STM32F4-Discovery/spi.c **** 		return 1;
 1322              		.loc 1 419 0
 1323 007e 0123     		movs	r3, #1
 1324 0080 23E0     		b	.L61
 1325              	.L56:
 420:App/STM32F4-Discovery/spi.c **** 	}
 421:App/STM32F4-Discovery/spi.c **** 	
 422:App/STM32F4-Discovery/spi.c **** 	// reading data
 423:App/STM32F4-Discovery/spi.c ****       else{
 424:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRH |= GPIO_Pin_4; // chip select 
 1326              		.loc 1 424 0
 1327 0082 144B     		ldr	r3, .L64
 1328 0084 134A     		ldr	r2, .L64
 1329 0086 528B     		ldrh	r2, [r2, #26]	@ movhi
 1330 0088 92B2     		uxth	r2, r2
 1331 008a 42F01002 		orr	r2, r2, #16
 1332 008e 92B2     		uxth	r2, r2
 1333 0090 5A83     		strh	r2, [r3, #26]	@ movhi
 425:App/STM32F4-Discovery/spi.c **** 		
 426:App/STM32F4-Discovery/spi.c **** 		for (idx = 0; idx < cmdbufflen; idx++)
 1334              		.loc 1 426 0
 1335 0092 0023     		movs	r3, #0
 1336 0094 FB75     		strb	r3, [r7, #23]
 1337 0096 0BE0     		b	.L62
 1338              	.L63:
 427:App/STM32F4-Discovery/spi.c **** 		{
 428:App/STM32F4-Discovery/spi.c **** 			d = SPI1_send(cmdbuff[idx]);
 1339              		.loc 1 428 0 discriminator 2
 1340 0098 FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 1341 009a BA68     		ldr	r2, [r7, #8]
 1342 009c 1344     		add	r3, r3, r2
 1343 009e 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1344 00a0 1846     		mov	r0, r3
 1345 00a2 FFF7FEFF 		bl	SPI1_send
 1346 00a6 0346     		mov	r3, r0
 1347 00a8 BB75     		strb	r3, [r7, #22]
 426:App/STM32F4-Discovery/spi.c **** 		for (idx = 0; idx < cmdbufflen; idx++)
 1348              		.loc 1 426 0 discriminator 2
 1349 00aa FB7D     		ldrb	r3, [r7, #23]	@ zero_extendqisi2
 1350 00ac 0133     		adds	r3, r3, #1
 1351 00ae FB75     		strb	r3, [r7, #23]
 1352              	.L62:
 426:App/STM32F4-Discovery/spi.c **** 		for (idx = 0; idx < cmdbufflen; idx++)
 1353              		.loc 1 426 0 is_stmt 0 discriminator 1
 1354 00b0 FA7D     		ldrb	r2, [r7, #23]	@ zero_extendqisi2
 1355 00b2 FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 1356 00b4 9A42     		cmp	r2, r3
 1357 00b6 EFD3     		bcc	.L63
 429:App/STM32F4-Discovery/spi.c **** 
 430:App/STM32F4-Discovery/spi.c **** 		}
 431:App/STM32F4-Discovery/spi.c **** 
 432:App/STM32F4-Discovery/spi.c **** 		GPIOA->BSRRL |= GPIO_Pin_4; // chip deselect 
 1358              		.loc 1 432 0 is_stmt 1
 1359 00b8 064B     		ldr	r3, .L64
 1360 00ba 064A     		ldr	r2, .L64
 1361 00bc 128B     		ldrh	r2, [r2, #24]	@ movhi
 1362 00be 92B2     		uxth	r2, r2
 1363 00c0 42F01002 		orr	r2, r2, #16
 1364 00c4 92B2     		uxth	r2, r2
 1365 00c6 1A83     		strh	r2, [r3, #24]	@ movhi
 433:App/STM32F4-Discovery/spi.c **** 		
 434:App/STM32F4-Discovery/spi.c **** 
 435:App/STM32F4-Discovery/spi.c **** 
 436:App/STM32F4-Discovery/spi.c **** 		return 1; 
 1366              		.loc 1 436 0
 1367 00c8 0123     		movs	r3, #1
 1368              	.L61:
 437:App/STM32F4-Discovery/spi.c **** 	}
 438:App/STM32F4-Discovery/spi.c **** 
 439:App/STM32F4-Discovery/spi.c **** 	return 0;
 440:App/STM32F4-Discovery/spi.c **** }
 1369              		.loc 1 440 0
 1370 00ca 1846     		mov	r0, r3
 1371 00cc 1837     		adds	r7, r7, #24
 1372 00ce BD46     		mov	sp, r7
 1373              		@ sp needed
 1374 00d0 80BD     		pop	{r7, pc}
 1375              	.L65:
 1376 00d2 00BF     		.align	2
 1377              	.L64:
 1378 00d4 00000240 		.word	1073872896
 1379              		.cfi_endproc
 1380              	.LFE121:
 1382              		.text
 1383              	.Letext0:
 1384              		.file 2 "/Users/maticknap/Downloads/gcc-arm-none-eabi-4_8-2014q2/arm-none-eabi/include/machine/_de
 1385              		.file 3 "/Users/maticknap/Downloads/gcc-arm-none-eabi-4_8-2014q2/arm-none-eabi/include/stdint.h"
 1386              		.file 4 "App/STM32F4-Discovery/Libraries/CMSIS/ST/STM32F4xx/Include/stm32f4xx.h"
 1387              		.file 5 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_dma.h"
 1388              		.file 6 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_exti.h"
 1389              		.file 7 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_gpio.h"
 1390              		.file 8 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_spi.h"
 1391              		.file 9 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/misc.h"
 1392              		.file 10 "App/STM32F4-Discovery/Libraries/CMSIS/Include/core_cm4.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 spi.c
                            *COM*:00000000000007d0 bufferTX
                            *COM*:00000000000007d0 bufferRX
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:26     .bss.bufferIndex:0000000000000000 bufferIndex
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:23     .bss.bufferIndex:0000000000000000 $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:33     .data.datalength:0000000000000000 datalength
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:30     .data.datalength:0000000000000000 $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:36     .text.init_SPI1:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:41     .text.init_SPI1:0000000000000000 init_SPI1
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:296    .text.init_SPI1:00000000000001d4 $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:302    .text.SPI_IRQHandler:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:307    .text.SPI_IRQHandler:0000000000000000 SPI_IRQHandler
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:376    .text.SPI_IRQHandler:0000000000000064 $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:385    .text.SPI1_DMA_TX_IRQHandler:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:390    .text.SPI1_DMA_TX_IRQHandler:0000000000000000 SPI1_DMA_TX_IRQHandler
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:446    .text.SPI1_DMA_TX_IRQHandler:0000000000000044 $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:454    .text.SPI1_send:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:459    .text.SPI1_send:0000000000000000 SPI1_send
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:520    .text.SPI1_send:000000000000004c $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:525    .text.SPI1_recive:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:530    .text.SPI1_recive:0000000000000000 SPI1_recive
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:579    .text.SPI1_recive:000000000000003c $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:584    .text.spi_dma_send:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:589    .text.spi_dma_send:0000000000000000 spi_dma_send
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:715    .text.spi_dma_send:00000000000000c4 $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:723    .text.spi_send:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:728    .text.spi_send:0000000000000000 spi_send
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:822    .text.spi_send:0000000000000094 $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:827    .text.spi_send2B:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:832    .text.spi_send2B:0000000000000000 spi_send2B
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:919    .text.spi_send2B:000000000000008c $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:924    .text.spi_sendByte:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:929    .text.spi_sendByte:0000000000000000 spi_sendByte
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1008   .text.spi_sendByte:000000000000007c $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1013   .text.spi_read2B:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1018   .text.spi_read2B:0000000000000000 spi_read2B
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1123   .text.spi_read2B:00000000000000a0 $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1128   .text.spi_read:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1133   .text.spi_read:0000000000000000 spi_read
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1226   .text.spi_read:000000000000008c $d
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1231   .text.spi_master_transfer:0000000000000000 $t
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1236   .text.spi_master_transfer:0000000000000000 spi_master_transfer
/var/folders/55/hyqmw0c94z570kz3rqrpw4jc0000gn/T//ccBCo3zg.s:1378   .text.spi_master_transfer:00000000000000d4 $d
                     .debug_frame:0000000000000010 $d

UNDEFINED SYMBOLS
RCC_AHB1PeriphClockCmd
GPIO_Init
GPIO_PinAFConfig
RCC_APB2PeriphClockCmd
SPI_Init
SYSCFG_EXTILineConfig
EXTI_Init
NVIC_Init
SPI_Cmd
SPI_I2S_ITConfig
SPI_I2S_ClearITPendingBit
DMA_GetITStatus
DMA_ClearITPendingBit
SPI_I2S_GetFlagStatus
SPI_I2S_SendData
SPI_I2S_ReceiveData
DMA_SetCurrDataCounter
DMA_Cmd
SPI_DMA_TX_IRQHandler
